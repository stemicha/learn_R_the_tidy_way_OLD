<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Advanced R</title>
  <meta name="description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side.">
  <meta name="generator" content="bookdown 0.7.12 and GitBook 2.6.7">

  <meta property="og:title" content="Advanced R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://adv-r.hadley.nz/" />
  <meta property="og:image" content="http://adv-r.hadley.nz/cover.png" />
  <meta property="og:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side." />
  <meta name="github-repo" content="hadley/adv-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Advanced R" />
  <meta name="twitter:site" content="@hadley" />
  <meta name="twitter:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side." />
  <meta name="twitter:image" content="http://adv-r.hadley.nz/cover.png" />

<meta name="author" content="Hadley Wickham">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="meta.html">
<link rel="next" href="quasiquotation.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="adv-r.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advanced R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-books"><i class="fa fa-check"></i>Other books</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#who-should-read"><i class="fa fa-check"></i><b>1.1</b> Who should read this book</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-you-will-get"><i class="fa fa-check"></i><b>1.2</b> What you will get out of this book</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#meta-techniques"><i class="fa fa-check"></i><b>1.3</b> Meta-techniques</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#recommended-reading"><i class="fa fa-check"></i><b>1.4</b> Recommended reading</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>1.5</b> Getting help</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#intro-ack"><i class="fa fa-check"></i><b>1.6</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#conventions"><i class="fa fa-check"></i><b>1.7</b> Conventions</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.8</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Data structures</a><ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#vectors"><i class="fa fa-check"></i><b>2.1</b> Vectors</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-structures.html"><a href="data-structures.html#atomic-vectors"><i class="fa fa-check"></i><b>2.1.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>2.1.2</b> Lists</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-structures.html"><a href="data-structures.html#exercises"><i class="fa fa-check"></i><b>2.1.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#attributes"><i class="fa fa-check"></i><b>2.2</b> Attributes</a><ul>
<li class="chapter" data-level="2.2.1" data-path="data-structures.html"><a href="data-structures.html#factors"><i class="fa fa-check"></i><b>2.2.1</b> Factors</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-structures.html"><a href="data-structures.html#exercises-1"><i class="fa fa-check"></i><b>2.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#matrices-and-arrays"><i class="fa fa-check"></i><b>2.3</b> Matrices and arrays</a><ul>
<li class="chapter" data-level="2.3.1" data-path="data-structures.html"><a href="data-structures.html#exercises-2"><i class="fa fa-check"></i><b>2.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#data-frames"><i class="fa fa-check"></i><b>2.4</b> Data frames</a><ul>
<li class="chapter" data-level="2.4.1" data-path="data-structures.html"><a href="data-structures.html#creation"><i class="fa fa-check"></i><b>2.4.1</b> Creation</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-structures.html"><a href="data-structures.html#testing-and-coercion"><i class="fa fa-check"></i><b>2.4.2</b> Testing and coercion</a></li>
<li class="chapter" data-level="2.4.3" data-path="data-structures.html"><a href="data-structures.html#combining-data-frames"><i class="fa fa-check"></i><b>2.4.3</b> Combining data frames</a></li>
<li class="chapter" data-level="2.4.4" data-path="data-structures.html"><a href="data-structures.html#special-columns"><i class="fa fa-check"></i><b>2.4.4</b> Special columns</a></li>
<li class="chapter" data-level="2.4.5" data-path="data-structures.html"><a href="data-structures.html#exercises-3"><i class="fa fa-check"></i><b>2.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="data-structures.html"><a href="data-structures.html#data-structure-answers"><i class="fa fa-check"></i><b>2.5</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>3</b> Subsetting</a><ul>
<li class="chapter" data-level="3.1" data-path="subsetting.html"><a href="subsetting.html#data-types"><i class="fa fa-check"></i><b>3.1</b> Data types</a><ul>
<li class="chapter" data-level="3.1.1" data-path="subsetting.html"><a href="subsetting.html#atomic-vectors-1"><i class="fa fa-check"></i><b>3.1.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="3.1.2" data-path="subsetting.html"><a href="subsetting.html#lists-1"><i class="fa fa-check"></i><b>3.1.2</b> Lists</a></li>
<li class="chapter" data-level="3.1.3" data-path="subsetting.html"><a href="subsetting.html#matrix-subsetting"><i class="fa fa-check"></i><b>3.1.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="3.1.4" data-path="subsetting.html"><a href="subsetting.html#df-subsetting"><i class="fa fa-check"></i><b>3.1.4</b> Data frames</a></li>
<li class="chapter" data-level="3.1.5" data-path="subsetting.html"><a href="subsetting.html#s3-objects"><i class="fa fa-check"></i><b>3.1.5</b> S3 objects</a></li>
<li class="chapter" data-level="3.1.6" data-path="subsetting.html"><a href="subsetting.html#s4-objects"><i class="fa fa-check"></i><b>3.1.6</b> S4 objects</a></li>
<li class="chapter" data-level="3.1.7" data-path="subsetting.html"><a href="subsetting.html#exercises-4"><i class="fa fa-check"></i><b>3.1.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="subsetting.html"><a href="subsetting.html#subsetting-operators"><i class="fa fa-check"></i><b>3.2</b> Subsetting operators</a><ul>
<li class="chapter" data-level="3.2.1" data-path="subsetting.html"><a href="subsetting.html#simplify-preserve"><i class="fa fa-check"></i><b>3.2.1</b> Simplifying vs. preserving subsetting</a></li>
<li class="chapter" data-level="3.2.2" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i><b>3.2.2</b> <code>$</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="subsetting.html"><a href="subsetting.html#missingout-of-bounds-indices"><i class="fa fa-check"></i><b>3.2.3</b> Missing/out of bounds indices</a></li>
<li class="chapter" data-level="3.2.4" data-path="subsetting.html"><a href="subsetting.html#exercises-5"><i class="fa fa-check"></i><b>3.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="subsetting.html"><a href="subsetting.html#subassignment"><i class="fa fa-check"></i><b>3.3</b> Subsetting and assignment</a></li>
<li class="chapter" data-level="3.4" data-path="subsetting.html"><a href="subsetting.html#applications"><i class="fa fa-check"></i><b>3.4</b> Applications</a><ul>
<li class="chapter" data-level="3.4.1" data-path="subsetting.html"><a href="subsetting.html#lookup-tables"><i class="fa fa-check"></i><b>3.4.1</b> Lookup tables (character subsetting)</a></li>
<li class="chapter" data-level="3.4.2" data-path="subsetting.html"><a href="subsetting.html#matching-merging"><i class="fa fa-check"></i><b>3.4.2</b> Matching and merging by hand (integer subsetting)</a></li>
<li class="chapter" data-level="3.4.3" data-path="subsetting.html"><a href="subsetting.html#random-samplesbootstrap-integer-subsetting"><i class="fa fa-check"></i><b>3.4.3</b> Random samples/bootstrap (integer subsetting)</a></li>
<li class="chapter" data-level="3.4.4" data-path="subsetting.html"><a href="subsetting.html#ordering-integer-subsetting"><i class="fa fa-check"></i><b>3.4.4</b> Ordering (integer subsetting)</a></li>
<li class="chapter" data-level="3.4.5" data-path="subsetting.html"><a href="subsetting.html#expanding-aggregated-counts-integer-subsetting"><i class="fa fa-check"></i><b>3.4.5</b> Expanding aggregated counts (integer subsetting)</a></li>
<li class="chapter" data-level="3.4.6" data-path="subsetting.html"><a href="subsetting.html#removing-columns-from-data-frames-character-subsetting"><i class="fa fa-check"></i><b>3.4.6</b> Removing columns from data frames (character subsetting)</a></li>
<li class="chapter" data-level="3.4.7" data-path="subsetting.html"><a href="subsetting.html#selecting-rows-based-on-a-condition-logical-subsetting"><i class="fa fa-check"></i><b>3.4.7</b> Selecting rows based on a condition (logical subsetting)</a></li>
<li class="chapter" data-level="3.4.8" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra-vs.sets-logical-integer-subsetting"><i class="fa fa-check"></i><b>3.4.8</b> Boolean algebra vs. sets (logical &amp; integer subsetting)</a></li>
<li class="chapter" data-level="3.4.9" data-path="subsetting.html"><a href="subsetting.html#exercises-6"><i class="fa fa-check"></i><b>3.4.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="subsetting.html"><a href="subsetting.html#subsetting-answers"><i class="fa fa-check"></i><b>3.5</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>4</b> Functions</a><ul>
<li class="chapter" data-level="4.1" data-path="functions.html"><a href="functions.html#function-components"><i class="fa fa-check"></i><b>4.1</b> Function components</a><ul>
<li class="chapter" data-level="4.1.1" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>4.1.1</b> Primitive functions</a></li>
<li class="chapter" data-level="4.1.2" data-path="functions.html"><a href="functions.html#exercises-7"><i class="fa fa-check"></i><b>4.1.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>4.2</b> Lexical scoping</a><ul>
<li class="chapter" data-level="4.2.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>4.2.1</b> Name masking</a></li>
<li class="chapter" data-level="4.2.2" data-path="functions.html"><a href="functions.html#functions-vs.variables"><i class="fa fa-check"></i><b>4.2.2</b> Functions vs. variables</a></li>
<li class="chapter" data-level="4.2.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>4.2.3</b> A fresh start</a></li>
<li class="chapter" data-level="4.2.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>4.2.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="4.2.5" data-path="functions.html"><a href="functions.html#exercises-8"><i class="fa fa-check"></i><b>4.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="functions.html"><a href="functions.html#all-calls"><i class="fa fa-check"></i><b>4.3</b> Every operation is a function call</a></li>
<li class="chapter" data-level="4.4" data-path="functions.html"><a href="functions.html#function-arguments"><i class="fa fa-check"></i><b>4.4</b> Function arguments</a><ul>
<li class="chapter" data-level="4.4.1" data-path="functions.html"><a href="functions.html#calling-functions"><i class="fa fa-check"></i><b>4.4.1</b> Calling functions</a></li>
<li class="chapter" data-level="4.4.2" data-path="functions.html"><a href="functions.html#calling-a-function-given-a-list-of-arguments"><i class="fa fa-check"></i><b>4.4.2</b> Calling a function given a list of arguments</a></li>
<li class="chapter" data-level="4.4.3" data-path="functions.html"><a href="functions.html#default-and-missing-arguments"><i class="fa fa-check"></i><b>4.4.3</b> Default and missing arguments</a></li>
<li class="chapter" data-level="4.4.4" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>4.4.4</b> Lazy evaluation</a></li>
<li class="chapter" data-level="4.4.5" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>4.4.5</b> <code>...</code></a></li>
<li class="chapter" data-level="4.4.6" data-path="functions.html"><a href="functions.html#exercises-9"><i class="fa fa-check"></i><b>4.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="functions.html"><a href="functions.html#special-calls"><i class="fa fa-check"></i><b>4.5</b> Special calls</a><ul>
<li class="chapter" data-level="4.5.1" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>4.5.1</b> Infix functions</a></li>
<li class="chapter" data-level="4.5.2" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>4.5.2</b> Replacement functions</a></li>
<li class="chapter" data-level="4.5.3" data-path="functions.html"><a href="functions.html#exercises-10"><i class="fa fa-check"></i><b>4.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="functions.html"><a href="functions.html#return-values"><i class="fa fa-check"></i><b>4.6</b> Return values</a><ul>
<li class="chapter" data-level="4.6.1" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>4.6.1</b> On exit</a></li>
<li class="chapter" data-level="4.6.2" data-path="functions.html"><a href="functions.html#exercises-11"><i class="fa fa-check"></i><b>4.6.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>4.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="memory.html"><a href="memory.html"><i class="fa fa-check"></i><b>5</b> Memory</a><ul>
<li class="chapter" data-level="5.1" data-path="memory.html"><a href="memory.html#object-size"><i class="fa fa-check"></i><b>5.1</b> Object size</a><ul>
<li class="chapter" data-level="5.1.1" data-path="memory.html"><a href="memory.html#exercises-12"><i class="fa fa-check"></i><b>5.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="memory.html"><a href="memory.html#gc"><i class="fa fa-check"></i><b>5.2</b> Memory usage and garbage collection</a></li>
<li class="chapter" data-level="5.3" data-path="memory.html"><a href="memory.html#memory-profiling"><i class="fa fa-check"></i><b>5.3</b> Memory profiling with lineprof</a><ul>
<li class="chapter" data-level="5.3.1" data-path="memory.html"><a href="memory.html#exercises-13"><i class="fa fa-check"></i><b>5.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="memory.html"><a href="memory.html#modification"><i class="fa fa-check"></i><b>5.4</b> Modification in place</a><ul>
<li class="chapter" data-level="5.4.1" data-path="memory.html"><a href="memory.html#loops"><i class="fa fa-check"></i><b>5.4.1</b> Loops</a></li>
<li class="chapter" data-level="5.4.2" data-path="memory.html"><a href="memory.html#exercises-14"><i class="fa fa-check"></i><b>5.4.2</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>6</b> Environments</a><ul>
<li class="chapter" data-level="6.1" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>6.1</b> Environment basics</a><ul>
<li class="chapter" data-level="6.1.1" data-path="environments.html"><a href="environments.html#exercises-15"><i class="fa fa-check"></i><b>6.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>6.2</b> Recursing over environments</a><ul>
<li class="chapter" data-level="6.2.1" data-path="environments.html"><a href="environments.html#exercises-16"><i class="fa fa-check"></i><b>6.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="environments.html"><a href="environments.html#function-envs"><i class="fa fa-check"></i><b>6.3</b> Function environments</a><ul>
<li class="chapter" data-level="6.3.1" data-path="environments.html"><a href="environments.html#the-enclosing-environment"><i class="fa fa-check"></i><b>6.3.1</b> The enclosing environment</a></li>
<li class="chapter" data-level="6.3.2" data-path="environments.html"><a href="environments.html#binding-environments"><i class="fa fa-check"></i><b>6.3.2</b> Binding environments</a></li>
<li class="chapter" data-level="6.3.3" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>6.3.3</b> Execution environments</a></li>
<li class="chapter" data-level="6.3.4" data-path="environments.html"><a href="environments.html#calling-environments"><i class="fa fa-check"></i><b>6.3.4</b> Calling environments</a></li>
<li class="chapter" data-level="6.3.5" data-path="environments.html"><a href="environments.html#exercises-17"><i class="fa fa-check"></i><b>6.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="environments.html"><a href="environments.html#binding"><i class="fa fa-check"></i><b>6.4</b> Binding names to values</a><ul>
<li class="chapter" data-level="6.4.1" data-path="environments.html"><a href="environments.html#exercises-18"><i class="fa fa-check"></i><b>6.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>6.5</b> Explicit environments</a><ul>
<li class="chapter" data-level="6.5.1" data-path="environments.html"><a href="environments.html#avoiding-copies"><i class="fa fa-check"></i><b>6.5.1</b> Avoiding copies</a></li>
<li class="chapter" data-level="6.5.2" data-path="environments.html"><a href="environments.html#package-state"><i class="fa fa-check"></i><b>6.5.2</b> Package state</a></li>
<li class="chapter" data-level="6.5.3" data-path="environments.html"><a href="environments.html#as-a-hashmap"><i class="fa fa-check"></i><b>6.5.3</b> As a hashmap</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>6.6</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>7</b> Debugging, condition handling, and defensive programming</a><ul>
<li class="chapter" data-level="7.1" data-path="debugging.html"><a href="debugging.html#debugging-techniques"><i class="fa fa-check"></i><b>7.1</b> Debugging techniques</a></li>
<li class="chapter" data-level="7.2" data-path="debugging.html"><a href="debugging.html#debugging-tools"><i class="fa fa-check"></i><b>7.2</b> Debugging tools</a><ul>
<li class="chapter" data-level="7.2.1" data-path="debugging.html"><a href="debugging.html#determining-the-sequence-of-calls"><i class="fa fa-check"></i><b>7.2.1</b> Determining the sequence of calls</a></li>
<li class="chapter" data-level="7.2.2" data-path="debugging.html"><a href="debugging.html#browsing-on-error"><i class="fa fa-check"></i><b>7.2.2</b> Browsing on error</a></li>
<li class="chapter" data-level="7.2.3" data-path="debugging.html"><a href="debugging.html#browsing-arbitrary-code"><i class="fa fa-check"></i><b>7.2.3</b> Browsing arbitrary code</a></li>
<li class="chapter" data-level="7.2.4" data-path="debugging.html"><a href="debugging.html#the-call-stack-traceback-where-and-recover"><i class="fa fa-check"></i><b>7.2.4</b> The call stack: <code>traceback()</code>, <code>where</code>, and <code>recover()</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="debugging.html"><a href="debugging.html#other-types-of-failure"><i class="fa fa-check"></i><b>7.2.5</b> Other types of failure</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="debugging.html"><a href="debugging.html#condition-handling"><i class="fa fa-check"></i><b>7.3</b> Condition handling</a><ul>
<li class="chapter" data-level="7.3.1" data-path="debugging.html"><a href="debugging.html#try"><i class="fa fa-check"></i><b>7.3.1</b> Ignore errors with try</a></li>
<li class="chapter" data-level="7.3.2" data-path="debugging.html"><a href="debugging.html#handle-conditions-with-trycatch"><i class="fa fa-check"></i><b>7.3.2</b> Handle conditions with <code>tryCatch()</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="debugging.html"><a href="debugging.html#withcallinghandlers"><i class="fa fa-check"></i><b>7.3.3</b> <code>withCallingHandlers()</code></a></li>
<li class="chapter" data-level="7.3.4" data-path="debugging.html"><a href="debugging.html#custom-signal-classes"><i class="fa fa-check"></i><b>7.3.4</b> Custom signal classes</a></li>
<li class="chapter" data-level="7.3.5" data-path="debugging.html"><a href="debugging.html#exercises-19"><i class="fa fa-check"></i><b>7.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="debugging.html"><a href="debugging.html#defensive-programming"><i class="fa fa-check"></i><b>7.4</b> Defensive programming</a><ul>
<li class="chapter" data-level="7.4.1" data-path="debugging.html"><a href="debugging.html#exercises-20"><i class="fa fa-check"></i><b>7.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="debugging.html"><a href="debugging.html#debugging-answers"><i class="fa fa-check"></i><b>7.5</b> Quiz answers</a></li>
</ul></li>
<li class="part"><span><b>II Functional programming</b></span></li>
<li class="chapter" data-level="8" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>8</b> Functional programming</a><ul>
<li class="chapter" data-level="8.1" data-path="functional-programming.html"><a href="functional-programming.html#fp-motivation"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="functional-programming.html"><a href="functional-programming.html#anonymous-functions"><i class="fa fa-check"></i><b>8.2</b> Anonymous functions</a><ul>
<li class="chapter" data-level="8.2.1" data-path="functional-programming.html"><a href="functional-programming.html#exercises-21"><i class="fa fa-check"></i><b>8.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="functional-programming.html"><a href="functional-programming.html#closures"><i class="fa fa-check"></i><b>8.3</b> Closures</a><ul>
<li class="chapter" data-level="8.3.1" data-path="functional-programming.html"><a href="functional-programming.html#function-factories"><i class="fa fa-check"></i><b>8.3.1</b> Function factories</a></li>
<li class="chapter" data-level="8.3.2" data-path="functional-programming.html"><a href="functional-programming.html#mutable-state"><i class="fa fa-check"></i><b>8.3.2</b> Mutable state</a></li>
<li class="chapter" data-level="8.3.3" data-path="functional-programming.html"><a href="functional-programming.html#exercises-22"><i class="fa fa-check"></i><b>8.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="functional-programming.html"><a href="functional-programming.html#lists-of-functions"><i class="fa fa-check"></i><b>8.4</b> Lists of functions</a><ul>
<li class="chapter" data-level="8.4.1" data-path="functional-programming.html"><a href="functional-programming.html#moving-lists-of-functions-to-the-global-environment"><i class="fa fa-check"></i><b>8.4.1</b> Moving lists of functions to the global environment</a></li>
<li class="chapter" data-level="8.4.2" data-path="functional-programming.html"><a href="functional-programming.html#exercises-23"><i class="fa fa-check"></i><b>8.4.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="functional-programming.html"><a href="functional-programming.html#numerical-integration"><i class="fa fa-check"></i><b>8.5</b> Case study: numerical integration</a><ul>
<li class="chapter" data-level="8.5.1" data-path="functional-programming.html"><a href="functional-programming.html#exercises-24"><i class="fa fa-check"></i><b>8.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a><ul>
<li class="chapter" data-level="9.1" data-path="functionals.html"><a href="functionals.html#lapply"><i class="fa fa-check"></i><b>9.1</b> My first functional: lapply()</a><ul>
<li class="chapter" data-level="9.1.1" data-path="functionals.html"><a href="functionals.html#looping-patterns"><i class="fa fa-check"></i><b>9.1.1</b> Looping patterns</a></li>
<li class="chapter" data-level="9.1.2" data-path="functionals.html"><a href="functionals.html#exercises-25"><i class="fa fa-check"></i><b>9.1.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="functionals.html"><a href="functionals.html#functionals-loop"><i class="fa fa-check"></i><b>9.2</b> For loop functionals: friends of lapply()</a><ul>
<li class="chapter" data-level="9.2.1" data-path="functionals.html"><a href="functionals.html#vector-output-sapply-and-vapply"><i class="fa fa-check"></i><b>9.2.1</b> Vector output: <code>sapply</code> and <code>vapply</code></a></li>
<li class="chapter" data-level="9.2.2" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>9.2.2</b> Multiple inputs: <code>Map</code> (and <code>mapply</code>)</a></li>
<li class="chapter" data-level="9.2.3" data-path="functionals.html"><a href="functionals.html#rolling-computations"><i class="fa fa-check"></i><b>9.2.3</b> Rolling computations</a></li>
<li class="chapter" data-level="9.2.4" data-path="functionals.html"><a href="functionals.html#parallelisation"><i class="fa fa-check"></i><b>9.2.4</b> Parallelisation</a></li>
<li class="chapter" data-level="9.2.5" data-path="functionals.html"><a href="functionals.html#exercises-26"><i class="fa fa-check"></i><b>9.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="functionals.html"><a href="functionals.html#functionals-ds"><i class="fa fa-check"></i><b>9.3</b> Manipulating matrices and data frames</a><ul>
<li class="chapter" data-level="9.3.1" data-path="functionals.html"><a href="functionals.html#matrix-and-array-operations"><i class="fa fa-check"></i><b>9.3.1</b> Matrix and array operations</a></li>
<li class="chapter" data-level="9.3.2" data-path="functionals.html"><a href="functionals.html#group-apply"><i class="fa fa-check"></i><b>9.3.2</b> Group apply</a></li>
<li class="chapter" data-level="9.3.3" data-path="functionals.html"><a href="functionals.html#the-plyr-package"><i class="fa fa-check"></i><b>9.3.3</b> The plyr package</a></li>
<li class="chapter" data-level="9.3.4" data-path="functionals.html"><a href="functionals.html#exercises-27"><i class="fa fa-check"></i><b>9.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="functionals.html"><a href="functionals.html#functionals-fp"><i class="fa fa-check"></i><b>9.4</b> Manipulating lists</a><ul>
<li class="chapter" data-level="9.4.1" data-path="functionals.html"><a href="functionals.html#reduce"><i class="fa fa-check"></i><b>9.4.1</b> <code>Reduce()</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="functionals.html"><a href="functionals.html#predicate-functionals"><i class="fa fa-check"></i><b>9.4.2</b> Predicate functionals</a></li>
<li class="chapter" data-level="9.4.3" data-path="functionals.html"><a href="functionals.html#exercises-28"><i class="fa fa-check"></i><b>9.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="functionals.html"><a href="functionals.html#functionals-math"><i class="fa fa-check"></i><b>9.5</b> Mathematical functionals</a><ul>
<li class="chapter" data-level="9.5.1" data-path="functionals.html"><a href="functionals.html#exercises-29"><i class="fa fa-check"></i><b>9.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="functionals.html"><a href="functionals.html#functionals-not"><i class="fa fa-check"></i><b>9.6</b> Loops that should be left as is</a><ul>
<li class="chapter" data-level="9.6.1" data-path="functionals.html"><a href="functionals.html#modifying-in-place"><i class="fa fa-check"></i><b>9.6.1</b> Modifying in place</a></li>
<li class="chapter" data-level="9.6.2" data-path="functionals.html"><a href="functionals.html#recursive-relationships"><i class="fa fa-check"></i><b>9.6.2</b> Recursive relationships</a></li>
<li class="chapter" data-level="9.6.3" data-path="functionals.html"><a href="functionals.html#while-loops"><i class="fa fa-check"></i><b>9.6.3</b> While loops</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="functionals.html"><a href="functionals.html#function-family"><i class="fa fa-check"></i><b>9.7</b> A family of functions</a><ul>
<li class="chapter" data-level="9.7.1" data-path="functionals.html"><a href="functionals.html#exercises-30"><i class="fa fa-check"></i><b>9.7.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>10</b> Function operators</a><ul>
<li class="chapter" data-level="10.1" data-path="function-operators.html"><a href="function-operators.html#behavioural-fos"><i class="fa fa-check"></i><b>10.1</b> Behavioural FOs</a><ul>
<li class="chapter" data-level="10.1.1" data-path="function-operators.html"><a href="function-operators.html#memoisation"><i class="fa fa-check"></i><b>10.1.1</b> Memoisation</a></li>
<li class="chapter" data-level="10.1.2" data-path="function-operators.html"><a href="function-operators.html#tee"><i class="fa fa-check"></i><b>10.1.2</b> Capturing function invocations</a></li>
<li class="chapter" data-level="10.1.3" data-path="function-operators.html"><a href="function-operators.html#laziness"><i class="fa fa-check"></i><b>10.1.3</b> Laziness</a></li>
<li class="chapter" data-level="10.1.4" data-path="function-operators.html"><a href="function-operators.html#exercises-31"><i class="fa fa-check"></i><b>10.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="function-operators.html"><a href="function-operators.html#output-fos"><i class="fa fa-check"></i><b>10.2</b> Output FOs</a><ul>
<li class="chapter" data-level="10.2.1" data-path="function-operators.html"><a href="function-operators.html#minor-modifications"><i class="fa fa-check"></i><b>10.2.1</b> Minor modifications</a></li>
<li class="chapter" data-level="10.2.2" data-path="function-operators.html"><a href="function-operators.html#changing-what-a-function-does"><i class="fa fa-check"></i><b>10.2.2</b> Changing what a function does</a></li>
<li class="chapter" data-level="10.2.3" data-path="function-operators.html"><a href="function-operators.html#exercises-32"><i class="fa fa-check"></i><b>10.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="function-operators.html"><a href="function-operators.html#input-fos"><i class="fa fa-check"></i><b>10.3</b> Input FOs</a><ul>
<li class="chapter" data-level="10.3.1" data-path="function-operators.html"><a href="function-operators.html#prefilling-function-arguments-partial-function-application"><i class="fa fa-check"></i><b>10.3.1</b> Prefilling function arguments: partial function application</a></li>
<li class="chapter" data-level="10.3.2" data-path="function-operators.html"><a href="function-operators.html#changing-input-types"><i class="fa fa-check"></i><b>10.3.2</b> Changing input types</a></li>
<li class="chapter" data-level="10.3.3" data-path="function-operators.html"><a href="function-operators.html#exercises-33"><i class="fa fa-check"></i><b>10.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="function-operators.html"><a href="function-operators.html#combining-fos"><i class="fa fa-check"></i><b>10.4</b> Combining FOs</a><ul>
<li class="chapter" data-level="10.4.1" data-path="function-operators.html"><a href="function-operators.html#function-composition"><i class="fa fa-check"></i><b>10.4.1</b> Function composition</a></li>
<li class="chapter" data-level="10.4.2" data-path="function-operators.html"><a href="function-operators.html#logical-predicates-and-boolean-algebra"><i class="fa fa-check"></i><b>10.4.2</b> Logical predicates and boolean algebra</a></li>
<li class="chapter" data-level="10.4.3" data-path="function-operators.html"><a href="function-operators.html#exercises-34"><i class="fa fa-check"></i><b>10.4.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Object oriented programming</b></span></li>
<li class="chapter" data-level="11" data-path="oo.html"><a href="oo.html"><i class="fa fa-check"></i><b>11</b> Introduction</a><ul>
<li class="chapter" data-level="11.1" data-path="oo.html"><a href="oo.html#oop-systems"><i class="fa fa-check"></i><b>11.1</b> OOP Systems</a></li>
<li class="chapter" data-level="11.2" data-path="oo.html"><a href="oo.html#oop-in-r"><i class="fa fa-check"></i><b>11.2</b> OOP in R</a></li>
<li class="chapter" data-level="11.3" data-path="oo.html"><a href="oo.html#field-guide"><i class="fa fa-check"></i><b>11.3</b> Field guide</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>12</b> Base types</a><ul>
<li class="chapter" data-level="12.1" data-path="base-types.html"><a href="base-types.html#base-objects-vs-oo-objects"><i class="fa fa-check"></i><b>12.1</b> Base objects vs OO objects</a></li>
<li class="chapter" data-level="12.2" data-path="base-types.html"><a href="base-types.html#base-types-2"><i class="fa fa-check"></i><b>12.2</b> Base types</a></li>
<li class="chapter" data-level="12.3" data-path="base-types.html"><a href="base-types.html#the-is-functions"><i class="fa fa-check"></i><b>12.3</b> The is functions</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>13</b> S3</a><ul>
<li class="chapter" data-level="13.1" data-path="s3.html"><a href="s3.html#s3-basics"><i class="fa fa-check"></i><b>13.1</b> Basics</a><ul>
<li class="chapter" data-level="13.1.1" data-path="s3.html"><a href="s3.html#exercises-35"><i class="fa fa-check"></i><b>13.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="s3.html"><a href="s3.html#classes"><i class="fa fa-check"></i><b>13.2</b> Classes</a><ul>
<li class="chapter" data-level="13.2.1" data-path="s3.html"><a href="s3.html#constructors"><i class="fa fa-check"></i><b>13.2.1</b> Constructors</a></li>
<li class="chapter" data-level="13.2.2" data-path="s3.html"><a href="s3.html#validators"><i class="fa fa-check"></i><b>13.2.2</b> Validators</a></li>
<li class="chapter" data-level="13.2.3" data-path="s3.html"><a href="s3.html#helpers"><i class="fa fa-check"></i><b>13.2.3</b> Helpers</a></li>
<li class="chapter" data-level="13.2.4" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i><b>13.2.4</b> Object styles</a></li>
<li class="chapter" data-level="13.2.5" data-path="s3.html"><a href="s3.html#exercises-36"><i class="fa fa-check"></i><b>13.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="s3.html"><a href="s3.html#generics-and-methods"><i class="fa fa-check"></i><b>13.3</b> Generics and methods</a><ul>
<li class="chapter" data-level="13.3.1" data-path="s3.html"><a href="s3.html#coercion-1"><i class="fa fa-check"></i><b>13.3.1</b> Coercion</a></li>
<li class="chapter" data-level="13.3.2" data-path="s3.html"><a href="s3.html#s3-arguments"><i class="fa fa-check"></i><b>13.3.2</b> Arguments</a></li>
<li class="chapter" data-level="13.3.3" data-path="s3.html"><a href="s3.html#exercises-37"><i class="fa fa-check"></i><b>13.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="s3.html"><a href="s3.html#method-dispatch"><i class="fa fa-check"></i><b>13.4</b> Method dispatch</a><ul>
<li class="chapter" data-level="13.4.1" data-path="s3.html"><a href="s3.html#usemethod"><i class="fa fa-check"></i><b>13.4.1</b> <code>UseMethod()</code></a></li>
<li class="chapter" data-level="13.4.2" data-path="s3.html"><a href="s3.html#nextmethod"><i class="fa fa-check"></i><b>13.4.2</b> <code>NextMethod()</code></a></li>
<li class="chapter" data-level="13.4.3" data-path="s3.html"><a href="s3.html#exercises-38"><i class="fa fa-check"></i><b>13.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="s3.html"><a href="s3.html#inheritance"><i class="fa fa-check"></i><b>13.5</b> Inheritance</a><ul>
<li class="chapter" data-level="13.5.1" data-path="s3.html"><a href="s3.html#constructors-1"><i class="fa fa-check"></i><b>13.5.1</b> Constructors</a></li>
<li class="chapter" data-level="13.5.2" data-path="s3.html"><a href="s3.html#coercion-2"><i class="fa fa-check"></i><b>13.5.2</b> Coercion</a></li>
<li class="chapter" data-level="13.5.3" data-path="s3.html"><a href="s3.html#methods"><i class="fa fa-check"></i><b>13.5.3</b> Methods</a></li>
<li class="chapter" data-level="13.5.4" data-path="s3.html"><a href="s3.html#exercises-39"><i class="fa fa-check"></i><b>13.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="s3.html"><a href="s3.html#dispatch-details"><i class="fa fa-check"></i><b>13.6</b> Dispatch details</a><ul>
<li class="chapter" data-level="13.6.1" data-path="s3.html"><a href="s3.html#environments-and-namespaces"><i class="fa fa-check"></i><b>13.6.1</b> Environments and namespaces</a></li>
<li class="chapter" data-level="13.6.2" data-path="s3.html"><a href="s3.html#s3-and-base-types"><i class="fa fa-check"></i><b>13.6.2</b> S3 and base types</a></li>
<li class="chapter" data-level="13.6.3" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i><b>13.6.3</b> Internal generics</a></li>
<li class="chapter" data-level="13.6.4" data-path="s3.html"><a href="s3.html#group-generics"><i class="fa fa-check"></i><b>13.6.4</b> Group generics</a></li>
<li class="chapter" data-level="13.6.5" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i><b>13.6.5</b> Double dispatch</a></li>
<li class="chapter" data-level="13.6.6" data-path="s3.html"><a href="s3.html#exercises-40"><i class="fa fa-check"></i><b>13.6.6</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>14</b> S4</a><ul>
<li class="chapter" data-level="14.1" data-path="s4.html"><a href="s4.html#classes-1"><i class="fa fa-check"></i><b>14.1</b> Classes</a><ul>
<li class="chapter" data-level="14.1.1" data-path="s4.html"><a href="s4.html#slots"><i class="fa fa-check"></i><b>14.1.1</b> Slots</a></li>
<li class="chapter" data-level="14.1.2" data-path="s4.html"><a href="s4.html#helper"><i class="fa fa-check"></i><b>14.1.2</b> Helper</a></li>
<li class="chapter" data-level="14.1.3" data-path="s4.html"><a href="s4.html#introspection"><i class="fa fa-check"></i><b>14.1.3</b> Introspection</a></li>
<li class="chapter" data-level="14.1.4" data-path="s4.html"><a href="s4.html#exercises-41"><i class="fa fa-check"></i><b>14.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="s4.html"><a href="s4.html#generics-and-methods-1"><i class="fa fa-check"></i><b>14.2</b> Generics and methods</a><ul>
<li class="chapter" data-level="14.2.1" data-path="s4.html"><a href="s4.html#show-method"><i class="fa fa-check"></i><b>14.2.1</b> Show method</a></li>
<li class="chapter" data-level="14.2.2" data-path="s4.html"><a href="s4.html#accessor-methods"><i class="fa fa-check"></i><b>14.2.2</b> Accessor methods</a></li>
<li class="chapter" data-level="14.2.3" data-path="s4.html"><a href="s4.html#coercion-methods"><i class="fa fa-check"></i><b>14.2.3</b> Coercion methods</a></li>
<li class="chapter" data-level="14.2.4" data-path="s4.html"><a href="s4.html#introspection-1"><i class="fa fa-check"></i><b>14.2.4</b> Introspection</a></li>
<li class="chapter" data-level="14.2.5" data-path="s4.html"><a href="s4.html#exercises-42"><i class="fa fa-check"></i><b>14.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="s4.html"><a href="s4.html#method-dispatch-1"><i class="fa fa-check"></i><b>14.3</b> Method dispatch</a><ul>
<li class="chapter" data-level="14.3.1" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i><b>14.3.1</b> Single dispatch</a></li>
<li class="chapter" data-level="14.3.2" data-path="s4.html"><a href="s4.html#multiple-inheritance"><i class="fa fa-check"></i><b>14.3.2</b> Multiple inheritance</a></li>
<li class="chapter" data-level="14.3.3" data-path="s4.html"><a href="s4.html#multiple-dispatch"><i class="fa fa-check"></i><b>14.3.3</b> Multiple dispatch</a></li>
<li class="chapter" data-level="14.3.4" data-path="s4.html"><a href="s4.html#multiple-dispatch-and-multiple-inheritance"><i class="fa fa-check"></i><b>14.3.4</b> Multiple dispatch and multiple inheritance</a></li>
<li class="chapter" data-level="14.3.5" data-path="s4.html"><a href="s4.html#exercises-43"><i class="fa fa-check"></i><b>14.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="s4.html"><a href="s4.html#s4-and-existing-code"><i class="fa fa-check"></i><b>14.4</b> S4 and existing code</a><ul>
<li class="chapter" data-level="14.4.1" data-path="s4.html"><a href="s4.html#classes-2"><i class="fa fa-check"></i><b>14.4.1</b> Classes</a></li>
<li class="chapter" data-level="14.4.2" data-path="s4.html"><a href="s4.html#generics"><i class="fa fa-check"></i><b>14.4.2</b> Generics</a></li>
<li class="chapter" data-level="14.4.3" data-path="s4.html"><a href="s4.html#exercises-44"><i class="fa fa-check"></i><b>14.4.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>15</b> R6</a><ul>
<li class="chapter" data-level="15.1" data-path="r6.html"><a href="r6.html#classes-and-methods"><i class="fa fa-check"></i><b>15.1</b> Classes and methods</a><ul>
<li class="chapter" data-level="15.1.1" data-path="r6.html"><a href="r6.html#method-chaining"><i class="fa fa-check"></i><b>15.1.1</b> Method chaining</a></li>
<li class="chapter" data-level="15.1.2" data-path="r6.html"><a href="r6.html#important-methods"><i class="fa fa-check"></i><b>15.1.2</b> Important methods</a></li>
<li class="chapter" data-level="15.1.3" data-path="r6.html"><a href="r6.html#adding-methods-after-creation"><i class="fa fa-check"></i><b>15.1.3</b> Adding methods after creation</a></li>
<li class="chapter" data-level="15.1.4" data-path="r6.html"><a href="r6.html#inheritance-1"><i class="fa fa-check"></i><b>15.1.4</b> Inheritance</a></li>
<li class="chapter" data-level="15.1.5" data-path="r6.html"><a href="r6.html#introspection-2"><i class="fa fa-check"></i><b>15.1.5</b> Introspection</a></li>
<li class="chapter" data-level="15.1.6" data-path="r6.html"><a href="r6.html#exercises-45"><i class="fa fa-check"></i><b>15.1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="r6.html"><a href="r6.html#controlling-access"><i class="fa fa-check"></i><b>15.2</b> Controlling access</a><ul>
<li class="chapter" data-level="15.2.1" data-path="r6.html"><a href="r6.html#privacy"><i class="fa fa-check"></i><b>15.2.1</b> Privacy</a></li>
<li class="chapter" data-level="15.2.2" data-path="r6.html"><a href="r6.html#active-fields"><i class="fa fa-check"></i><b>15.2.2</b> Active fields</a></li>
<li class="chapter" data-level="15.2.3" data-path="r6.html"><a href="r6.html#exercises-46"><i class="fa fa-check"></i><b>15.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="r6.html"><a href="r6.html#reference-semantics"><i class="fa fa-check"></i><b>15.3</b> Reference semantics</a><ul>
<li class="chapter" data-level="15.3.1" data-path="r6.html"><a href="r6.html#reasoning"><i class="fa fa-check"></i><b>15.3.1</b> Reasoning</a></li>
<li class="chapter" data-level="15.3.2" data-path="r6.html"><a href="r6.html#finalizer"><i class="fa fa-check"></i><b>15.3.2</b> Finalizer</a></li>
<li class="chapter" data-level="15.3.3" data-path="r6.html"><a href="r6.html#r6-fields"><i class="fa fa-check"></i><b>15.3.3</b> R6 fields</a></li>
<li class="chapter" data-level="15.3.4" data-path="r6.html"><a href="r6.html#exercises-47"><i class="fa fa-check"></i><b>15.3.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html"><i class="fa fa-check"></i><b>16</b> Trade-offs</a><ul>
<li class="chapter" data-level="16.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-s4"><i class="fa fa-check"></i><b>16.1</b> S4 vs S3</a></li>
<li class="chapter" data-level="16.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-r6"><i class="fa fa-check"></i><b>16.2</b> R6 vs S3</a><ul>
<li class="chapter" data-level="16.2.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#namespacing"><i class="fa fa-check"></i><b>16.2.1</b> Namespacing</a></li>
<li class="chapter" data-level="16.2.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#threading-state"><i class="fa fa-check"></i><b>16.2.2</b> Threading state</a></li>
<li class="chapter" data-level="16.2.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#tradeoffs-pipe"><i class="fa fa-check"></i><b>16.2.3</b> Method chaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Metaprogramming</b></span></li>
<li class="chapter" data-level="17" data-path="meta.html"><a href="meta.html"><i class="fa fa-check"></i><b>17</b> Introduction</a></li>
<li class="chapter" data-level="18" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>18</b> Expressions</a><ul>
<li class="chapter" data-level="18.1" data-path="expressions.html"><a href="expressions.html#abstract-syntax-trees"><i class="fa fa-check"></i><b>18.1</b> Abstract syntax trees</a><ul>
<li class="chapter" data-level="18.1.1" data-path="expressions.html"><a href="expressions.html#infix-vs.prefix-calls"><i class="fa fa-check"></i><b>18.1.1</b> Infix vs. prefix calls</a></li>
<li class="chapter" data-level="18.1.2" data-path="expressions.html"><a href="expressions.html#special-forms"><i class="fa fa-check"></i><b>18.1.2</b> Special forms</a></li>
<li class="chapter" data-level="18.1.3" data-path="expressions.html"><a href="expressions.html#function-factories-1"><i class="fa fa-check"></i><b>18.1.3</b> Function factories</a></li>
<li class="chapter" data-level="18.1.4" data-path="expressions.html"><a href="expressions.html#argument-names"><i class="fa fa-check"></i><b>18.1.4</b> Argument names</a></li>
<li class="chapter" data-level="18.1.5" data-path="expressions.html"><a href="expressions.html#exercises-48"><i class="fa fa-check"></i><b>18.1.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="expressions.html"><a href="expressions.html#rs-grammar"><i class="fa fa-check"></i><b>18.2</b> R’s grammar</a><ul>
<li class="chapter" data-level="18.2.1" data-path="expressions.html"><a href="expressions.html#operator-precedence-and-associativity"><i class="fa fa-check"></i><b>18.2.1</b> Operator precedence and associativity</a></li>
<li class="chapter" data-level="18.2.2" data-path="expressions.html"><a href="expressions.html#whitespace"><i class="fa fa-check"></i><b>18.2.2</b> Whitespace</a></li>
<li class="chapter" data-level="18.2.3" data-path="expressions.html"><a href="expressions.html#parsing-a-string"><i class="fa fa-check"></i><b>18.2.3</b> Parsing a string</a></li>
<li class="chapter" data-level="18.2.4" data-path="expressions.html"><a href="expressions.html#deparsing"><i class="fa fa-check"></i><b>18.2.4</b> Deparsing</a></li>
<li class="chapter" data-level="18.2.5" data-path="expressions.html"><a href="expressions.html#exercises-49"><i class="fa fa-check"></i><b>18.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="data-structures.html"><a href="data-structures.html#data-structures"><i class="fa fa-check"></i><b>18.3</b> Data structures</a><ul>
<li class="chapter" data-level="18.3.1" data-path="expressions.html"><a href="expressions.html#constants-and-symbols"><i class="fa fa-check"></i><b>18.3.1</b> Constants and symbols</a></li>
<li class="chapter" data-level="18.3.2" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>18.3.2</b> Calls</a></li>
<li class="chapter" data-level="18.3.3" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>18.3.3</b> Pairlists</a></li>
<li class="chapter" data-level="18.3.4" data-path="expressions.html"><a href="expressions.html#expression-objects"><i class="fa fa-check"></i><b>18.3.4</b> Expression objects</a></li>
<li class="chapter" data-level="18.3.5" data-path="expressions.html"><a href="expressions.html#exercises-50"><i class="fa fa-check"></i><b>18.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="expressions.html"><a href="expressions.html#case-study-anaphoric-functions"><i class="fa fa-check"></i><b>18.4</b> Case study: anaphoric functions</a><ul>
<li class="chapter" data-level="18.4.1" data-path="expressions.html"><a href="expressions.html#exercises-51"><i class="fa fa-check"></i><b>18.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="expressions.html"><a href="expressions.html#ast-funs"><i class="fa fa-check"></i><b>18.5</b> Case study: Walking the AST with recursive functions</a><ul>
<li class="chapter" data-level="18.5.1" data-path="expressions.html"><a href="expressions.html#finding-f-and-t"><i class="fa fa-check"></i><b>18.5.1</b> Finding F and T</a></li>
<li class="chapter" data-level="18.5.2" data-path="expressions.html"><a href="expressions.html#finding-all-variables-created-by-assignment"><i class="fa fa-check"></i><b>18.5.2</b> Finding all variables created by assignment</a></li>
<li class="chapter" data-level="18.5.3" data-path="expressions.html"><a href="expressions.html#exercises-52"><i class="fa fa-check"></i><b>18.5.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>19</b> Quasiquotation</a><ul>
<li class="chapter" data-level="19.1" data-path="quasiquotation.html"><a href="quasiquotation.html#introduction-1"><i class="fa fa-check"></i><b>19.1</b> Introduction</a><ul>
<li class="chapter" data-level="19.1.1" data-path="quasiquotation.html"><a href="quasiquotation.html#motivation"><i class="fa fa-check"></i><b>19.1.1</b> Motivation</a></li>
<li class="chapter" data-level="19.1.2" data-path="quasiquotation.html"><a href="quasiquotation.html#theory"><i class="fa fa-check"></i><b>19.1.2</b> Theory</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="quasiquotation.html"><a href="quasiquotation.html#quotation"><i class="fa fa-check"></i><b>19.2</b> Quotation</a><ul>
<li class="chapter" data-level="19.2.1" data-path="quasiquotation.html"><a href="quasiquotation.html#with-rlang"><i class="fa fa-check"></i><b>19.2.1</b> With rlang</a></li>
<li class="chapter" data-level="19.2.2" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i><b>19.2.2</b> With base R</a></li>
<li class="chapter" data-level="19.2.3" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-53"><i class="fa fa-check"></i><b>19.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="quasiquotation.html"><a href="quasiquotation.html#eval-basics"><i class="fa fa-check"></i><b>19.3</b> Evaluation</a></li>
<li class="chapter" data-level="19.4" data-path="quasiquotation.html"><a href="quasiquotation.html#unquotation"><i class="fa fa-check"></i><b>19.4</b> Unquotation</a><ul>
<li class="chapter" data-level="19.4.1" data-path="quasiquotation.html"><a href="quasiquotation.html#with-rlang-1"><i class="fa fa-check"></i><b>19.4.1</b> With rlang</a></li>
<li class="chapter" data-level="19.4.2" data-path="quasiquotation.html"><a href="quasiquotation.html#the-polite-fiction-of"><i class="fa fa-check"></i><b>19.4.2</b> The polite fiction of <code>!!</code></a></li>
<li class="chapter" data-level="19.4.3" data-path="quasiquotation.html"><a href="quasiquotation.html#unquote-base"><i class="fa fa-check"></i><b>19.4.3</b> With base R</a></li>
<li class="chapter" data-level="19.4.4" data-path="quasiquotation.html"><a href="quasiquotation.html#non-standard-asts"><i class="fa fa-check"></i><b>19.4.4</b> Non-standard ASTs</a></li>
<li class="chapter" data-level="19.4.5" data-path="quasiquotation.html"><a href="quasiquotation.html#missing-arguments"><i class="fa fa-check"></i><b>19.4.5</b> Missing arguments</a></li>
<li class="chapter" data-level="19.4.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-54"><i class="fa fa-check"></i><b>19.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-case-studies"><i class="fa fa-check"></i><b>19.5</b> Case studies</a><ul>
<li class="chapter" data-level="19.5.1" data-path="quasiquotation.html"><a href="quasiquotation.html#map-reduce-to-generate-code"><i class="fa fa-check"></i><b>19.5.1</b> Map-reduce to generate code</a></li>
<li class="chapter" data-level="19.5.2" data-path="quasiquotation.html"><a href="quasiquotation.html#calling-quoting-functions"><i class="fa fa-check"></i><b>19.5.2</b> Calling quoting functions</a></li>
<li class="chapter" data-level="19.5.3" data-path="quasiquotation.html"><a href="quasiquotation.html#partition"><i class="fa fa-check"></i><b>19.5.3</b> Partition</a></li>
<li class="chapter" data-level="19.5.4" data-path="quasiquotation.html"><a href="quasiquotation.html#tangling-with-dots"><i class="fa fa-check"></i><b>19.5.4</b> Tangling with dots</a></li>
<li class="chapter" data-level="19.5.5" data-path="quasiquotation.html"><a href="quasiquotation.html#slicing-an-array"><i class="fa fa-check"></i><b>19.5.5</b> Slicing an array</a></li>
<li class="chapter" data-level="19.5.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-55"><i class="fa fa-check"></i><b>19.5.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="quasiquotation.html"><a href="quasiquotation.html#dot-dot-dot-..."><i class="fa fa-check"></i><b>19.6</b> Dot-dot-dot (<code>...</code>)</a><ul>
<li class="chapter" data-level="19.6.1" data-path="quasiquotation.html"><a href="quasiquotation.html#do.call"><i class="fa fa-check"></i><b>19.6.1</b> <code>do.call()</code></a></li>
<li class="chapter" data-level="19.6.2" data-path="quasiquotation.html"><a href="quasiquotation.html#the-tidyverse-approach"><i class="fa fa-check"></i><b>19.6.2</b> The tidyverse approach</a></li>
<li class="chapter" data-level="19.6.3" data-path="quasiquotation.html"><a href="quasiquotation.html#dots_list"><i class="fa fa-check"></i><b>19.6.3</b> <code>dots_list()</code></a></li>
<li class="chapter" data-level="19.6.4" data-path="quasiquotation.html"><a href="quasiquotation.html#application-invoke-and-lang"><i class="fa fa-check"></i><b>19.6.4</b> Application: <code>invoke()</code> and <code>lang()</code></a></li>
<li class="chapter" data-level="19.6.5" data-path="quasiquotation.html"><a href="quasiquotation.html#other-approaches"><i class="fa fa-check"></i><b>19.6.5</b> Other approaches</a></li>
<li class="chapter" data-level="19.6.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-56"><i class="fa fa-check"></i><b>19.6.6</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>20</b> Evaluation</a><ul>
<li class="chapter" data-level="20.1" data-path="evaluation.html"><a href="evaluation.html#introduction-2"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
<li class="chapter" data-level="20.2" data-path="evaluation.html"><a href="evaluation.html#evaluation-basics"><i class="fa fa-check"></i><b>20.2</b> Evaluation basics</a><ul>
<li class="chapter" data-level="20.2.1" data-path="evaluation.html"><a href="evaluation.html#application-local"><i class="fa fa-check"></i><b>20.2.1</b> Application: <code>local()</code></a></li>
<li class="chapter" data-level="20.2.2" data-path="evaluation.html"><a href="evaluation.html#application-source"><i class="fa fa-check"></i><b>20.2.2</b> Application: <code>source()</code></a></li>
<li class="chapter" data-level="20.2.3" data-path="evaluation.html"><a href="evaluation.html#gotcha-function"><i class="fa fa-check"></i><b>20.2.3</b> Gotcha: <code>function()</code></a></li>
<li class="chapter" data-level="20.2.4" data-path="evaluation.html"><a href="evaluation.html#base-r"><i class="fa fa-check"></i><b>20.2.4</b> Base R</a></li>
<li class="chapter" data-level="20.2.5" data-path="evaluation.html"><a href="evaluation.html#exercises-57"><i class="fa fa-check"></i><b>20.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="evaluation.html"><a href="evaluation.html#quosures"><i class="fa fa-check"></i><b>20.3</b> Quosures</a><ul>
<li class="chapter" data-level="20.3.1" data-path="evaluation.html"><a href="evaluation.html#motivation-1"><i class="fa fa-check"></i><b>20.3.1</b> Motivation</a></li>
<li class="chapter" data-level="20.3.2" data-path="evaluation.html"><a href="evaluation.html#creating-and-manipulating"><i class="fa fa-check"></i><b>20.3.2</b> Creating and manipulating</a></li>
<li class="chapter" data-level="20.3.3" data-path="evaluation.html"><a href="evaluation.html#implementation"><i class="fa fa-check"></i><b>20.3.3</b> Implementation</a></li>
<li class="chapter" data-level="20.3.4" data-path="evaluation.html"><a href="evaluation.html#multiple-environments"><i class="fa fa-check"></i><b>20.3.4</b> Multiple environments</a></li>
<li class="chapter" data-level="20.3.5" data-path="evaluation.html"><a href="evaluation.html#embedded-quosures"><i class="fa fa-check"></i><b>20.3.5</b> Embedded quosures</a></li>
<li class="chapter" data-level="20.3.6" data-path="evaluation.html"><a href="evaluation.html#when-not-to-use-quosures"><i class="fa fa-check"></i><b>20.3.6</b> When not to use quosures</a></li>
<li class="chapter" data-level="20.3.7" data-path="evaluation.html"><a href="evaluation.html#exercises-58"><i class="fa fa-check"></i><b>20.3.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation"><i class="fa fa-check"></i><b>20.4</b> Tidy evaluation</a><ul>
<li class="chapter" data-level="20.4.1" data-path="evaluation.html"><a href="evaluation.html#eval_tidy"><i class="fa fa-check"></i><b>20.4.1</b> <code>eval_tidy()</code></a></li>
<li class="chapter" data-level="20.4.2" data-path="evaluation.html"><a href="evaluation.html#data-masks"><i class="fa fa-check"></i><b>20.4.2</b> Data masks</a></li>
<li class="chapter" data-level="20.4.3" data-path="evaluation.html"><a href="evaluation.html#application-subset"><i class="fa fa-check"></i><b>20.4.3</b> Application: <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.4" data-path="evaluation.html"><a href="evaluation.html#application-arrange"><i class="fa fa-check"></i><b>20.4.4</b> Application: <code>arrange()</code></a></li>
<li class="chapter" data-level="20.4.5" data-path="evaluation.html"><a href="evaluation.html#ambiguity-and-pronouns"><i class="fa fa-check"></i><b>20.4.5</b> Ambiguity and pronouns</a></li>
<li class="chapter" data-level="20.4.6" data-path="evaluation.html"><a href="evaluation.html#base-subset"><i class="fa fa-check"></i><b>20.4.6</b> Base <code>subset()</code></a></li>
<li class="chapter" data-level="20.4.7" data-path="evaluation.html"><a href="evaluation.html#tidy-eval-performance"><i class="fa fa-check"></i><b>20.4.7</b> Performance</a></li>
<li class="chapter" data-level="20.4.8" data-path="evaluation.html"><a href="evaluation.html#exercises-59"><i class="fa fa-check"></i><b>20.4.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="evaluation.html"><a href="evaluation.html#case-study-calling-base-nse-functions"><i class="fa fa-check"></i><b>20.5</b> Case study: calling base NSE functions</a><ul>
<li class="chapter" data-level="20.5.1" data-path="evaluation.html"><a href="evaluation.html#basics"><i class="fa fa-check"></i><b>20.5.1</b> Basics</a></li>
<li class="chapter" data-level="20.5.2" data-path="evaluation.html"><a href="evaluation.html#the-evaluation-environment"><i class="fa fa-check"></i><b>20.5.2</b> The evaluation environment</a></li>
<li class="chapter" data-level="20.5.3" data-path="evaluation.html"><a href="evaluation.html#making-formulas"><i class="fa fa-check"></i><b>20.5.3</b> Making formulas</a></li>
<li class="chapter" data-level="20.5.4" data-path="evaluation.html"><a href="evaluation.html#exercises-60"><i class="fa fa-check"></i><b>20.5.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="translation.html"><a href="translation.html"><i class="fa fa-check"></i><b>21</b> Translating R code</a><ul>
<li class="chapter" data-level="21.1" data-path="translation.html"><a href="translation.html#html"><i class="fa fa-check"></i><b>21.1</b> HTML</a><ul>
<li class="chapter" data-level="21.1.1" data-path="translation.html"><a href="translation.html#goal"><i class="fa fa-check"></i><b>21.1.1</b> Goal</a></li>
<li class="chapter" data-level="21.1.2" data-path="translation.html"><a href="translation.html#escaping"><i class="fa fa-check"></i><b>21.1.2</b> Escaping</a></li>
<li class="chapter" data-level="21.1.3" data-path="translation.html"><a href="translation.html#basic-tag-functions"><i class="fa fa-check"></i><b>21.1.3</b> Basic tag functions</a></li>
<li class="chapter" data-level="21.1.4" data-path="translation.html"><a href="translation.html#tag-functions"><i class="fa fa-check"></i><b>21.1.4</b> Tag functions</a></li>
<li class="chapter" data-level="21.1.5" data-path="translation.html"><a href="translation.html#processing-all-tags"><i class="fa fa-check"></i><b>21.1.5</b> Processing all tags</a></li>
<li class="chapter" data-level="21.1.6" data-path="translation.html"><a href="translation.html#exercises-61"><i class="fa fa-check"></i><b>21.1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="translation.html"><a href="translation.html#latex"><i class="fa fa-check"></i><b>21.2</b> LaTeX</a><ul>
<li class="chapter" data-level="21.2.1" data-path="translation.html"><a href="translation.html#latex-mathematics"><i class="fa fa-check"></i><b>21.2.1</b> LaTeX mathematics</a></li>
<li class="chapter" data-level="21.2.2" data-path="translation.html"><a href="translation.html#goal-1"><i class="fa fa-check"></i><b>21.2.2</b> Goal</a></li>
<li class="chapter" data-level="21.2.3" data-path="translation.html"><a href="translation.html#to_math"><i class="fa fa-check"></i><b>21.2.3</b> <code>to_math</code></a></li>
<li class="chapter" data-level="21.2.4" data-path="translation.html"><a href="translation.html#known-symbols"><i class="fa fa-check"></i><b>21.2.4</b> Known symbols</a></li>
<li class="chapter" data-level="21.2.5" data-path="translation.html"><a href="translation.html#unknown-symbols"><i class="fa fa-check"></i><b>21.2.5</b> Unknown symbols</a></li>
<li class="chapter" data-level="21.2.6" data-path="translation.html"><a href="translation.html#known-functions"><i class="fa fa-check"></i><b>21.2.6</b> Known functions</a></li>
<li class="chapter" data-level="21.2.7" data-path="translation.html"><a href="translation.html#unknown-functions"><i class="fa fa-check"></i><b>21.2.7</b> Unknown functions</a></li>
<li class="chapter" data-level="21.2.8" data-path="translation.html"><a href="translation.html#exercises-62"><i class="fa fa-check"></i><b>21.2.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Performance</b></span></li>
<li class="chapter" data-level="22" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>22</b> Performance</a><ul>
<li class="chapter" data-level="22.1" data-path="performance.html"><a href="performance.html#why-is-r-slow"><i class="fa fa-check"></i><b>22.1</b> Why is R slow?</a></li>
<li class="chapter" data-level="22.2" data-path="performance.html"><a href="performance.html#microbenchmarking"><i class="fa fa-check"></i><b>22.2</b> Microbenchmarking</a><ul>
<li class="chapter" data-level="22.2.1" data-path="performance.html"><a href="performance.html#exercises-63"><i class="fa fa-check"></i><b>22.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="performance.html"><a href="performance.html#language-performance"><i class="fa fa-check"></i><b>22.3</b> Language performance</a><ul>
<li class="chapter" data-level="22.3.1" data-path="performance.html"><a href="performance.html#extreme-dynamism"><i class="fa fa-check"></i><b>22.3.1</b> Extreme dynamism</a></li>
<li class="chapter" data-level="22.3.2" data-path="performance.html"><a href="performance.html#name-lookup-with-mutable-environments"><i class="fa fa-check"></i><b>22.3.2</b> Name lookup with mutable environments</a></li>
<li class="chapter" data-level="22.3.3" data-path="performance.html"><a href="performance.html#lazy-evaluation-overhead"><i class="fa fa-check"></i><b>22.3.3</b> Lazy evaluation overhead</a></li>
<li class="chapter" data-level="22.3.4" data-path="performance.html"><a href="performance.html#exercises-64"><i class="fa fa-check"></i><b>22.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="performance.html"><a href="performance.html#implementation-performance"><i class="fa fa-check"></i><b>22.4</b> Implementation performance</a><ul>
<li class="chapter" data-level="22.4.1" data-path="performance.html"><a href="performance.html#extracting-a-single-value-from-a-data-frame"><i class="fa fa-check"></i><b>22.4.1</b> Extracting a single value from a data frame</a></li>
<li class="chapter" data-level="22.4.2" data-path="performance.html"><a href="performance.html#ifelse-pmin-and-pmax"><i class="fa fa-check"></i><b>22.4.2</b> <code>ifelse()</code>, <code>pmin()</code>, and <code>pmax()</code></a></li>
<li class="chapter" data-level="22.4.3" data-path="performance.html"><a href="performance.html#exercises-65"><i class="fa fa-check"></i><b>22.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="performance.html"><a href="performance.html#faster-r"><i class="fa fa-check"></i><b>22.5</b> Alternative R implementations</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="profiling.html"><a href="profiling.html"><i class="fa fa-check"></i><b>23</b> Optimising code</a><ul>
<li class="chapter" data-level="23.1" data-path="profiling.html"><a href="profiling.html#measure-perf"><i class="fa fa-check"></i><b>23.1</b> Measuring performance</a><ul>
<li class="chapter" data-level="23.1.1" data-path="profiling.html"><a href="profiling.html#limitations"><i class="fa fa-check"></i><b>23.1.1</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="profiling.html"><a href="profiling.html#improve-perf"><i class="fa fa-check"></i><b>23.2</b> Improving performance</a></li>
<li class="chapter" data-level="23.3" data-path="profiling.html"><a href="profiling.html#code-organisation"><i class="fa fa-check"></i><b>23.3</b> Code organisation</a></li>
<li class="chapter" data-level="23.4" data-path="profiling.html"><a href="profiling.html#already-solved"><i class="fa fa-check"></i><b>23.4</b> Has someone already solved the problem?</a><ul>
<li class="chapter" data-level="23.4.1" data-path="profiling.html"><a href="profiling.html#exercises-66"><i class="fa fa-check"></i><b>23.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="profiling.html"><a href="profiling.html#be-lazy"><i class="fa fa-check"></i><b>23.5</b> Do as little as possible</a><ul>
<li class="chapter" data-level="23.5.1" data-path="profiling.html"><a href="profiling.html#exercises-67"><i class="fa fa-check"></i><b>23.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.6" data-path="profiling.html"><a href="profiling.html#vectorise"><i class="fa fa-check"></i><b>23.6</b> Vectorise</a><ul>
<li class="chapter" data-level="23.6.1" data-path="profiling.html"><a href="profiling.html#exercises-68"><i class="fa fa-check"></i><b>23.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.7" data-path="profiling.html"><a href="profiling.html#avoid-copies"><i class="fa fa-check"></i><b>23.7</b> Avoid copies</a></li>
<li class="chapter" data-level="23.8" data-path="profiling.html"><a href="profiling.html#byte-code"><i class="fa fa-check"></i><b>23.8</b> Byte code compilation</a></li>
<li class="chapter" data-level="23.9" data-path="profiling.html"><a href="profiling.html#t-test"><i class="fa fa-check"></i><b>23.9</b> Case study: t-test</a></li>
<li class="chapter" data-level="23.10" data-path="profiling.html"><a href="profiling.html#parallelise"><i class="fa fa-check"></i><b>23.10</b> Parallelise</a></li>
<li class="chapter" data-level="23.11" data-path="profiling.html"><a href="profiling.html#more-techniques"><i class="fa fa-check"></i><b>23.11</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>24</b> High performance functions with Rcpp</a><ul>
<li class="chapter" data-level="24.1" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro"><i class="fa fa-check"></i><b>24.1</b> Getting started with C++</a><ul>
<li class="chapter" data-level="24.1.1" data-path="rcpp.html"><a href="rcpp.html#no-inputs-scalar-output"><i class="fa fa-check"></i><b>24.1.1</b> No inputs, scalar output</a></li>
<li class="chapter" data-level="24.1.2" data-path="rcpp.html"><a href="rcpp.html#scalar-input-scalar-output"><i class="fa fa-check"></i><b>24.1.2</b> Scalar input, scalar output</a></li>
<li class="chapter" data-level="24.1.3" data-path="rcpp.html"><a href="rcpp.html#vector-input-scalar-output"><i class="fa fa-check"></i><b>24.1.3</b> Vector input, scalar output</a></li>
<li class="chapter" data-level="24.1.4" data-path="rcpp.html"><a href="rcpp.html#vector-input-vector-output"><i class="fa fa-check"></i><b>24.1.4</b> Vector input, vector output</a></li>
<li class="chapter" data-level="24.1.5" data-path="rcpp.html"><a href="rcpp.html#matrix-input-vector-output"><i class="fa fa-check"></i><b>24.1.5</b> Matrix input, vector output</a></li>
<li class="chapter" data-level="24.1.6" data-path="rcpp.html"><a href="rcpp.html#sourceCpp"><i class="fa fa-check"></i><b>24.1.6</b> Using sourceCpp</a></li>
<li class="chapter" data-level="24.1.7" data-path="rcpp.html"><a href="rcpp.html#exercises-69"><i class="fa fa-check"></i><b>24.1.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-classes"><i class="fa fa-check"></i><b>24.2</b> Attributes and other classes</a><ul>
<li class="chapter" data-level="24.2.1" data-path="rcpp.html"><a href="rcpp.html#lists-and-data-frames"><i class="fa fa-check"></i><b>24.2.1</b> Lists and data frames</a></li>
<li class="chapter" data-level="24.2.2" data-path="rcpp.html"><a href="rcpp.html#functions-rcpp"><i class="fa fa-check"></i><b>24.2.2</b> Functions</a></li>
<li class="chapter" data-level="24.2.3" data-path="rcpp.html"><a href="rcpp.html#other-types"><i class="fa fa-check"></i><b>24.2.3</b> Other types</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-na"><i class="fa fa-check"></i><b>24.3</b> Missing values</a><ul>
<li class="chapter" data-level="24.3.1" data-path="rcpp.html"><a href="rcpp.html#scalars"><i class="fa fa-check"></i><b>24.3.1</b> Scalars</a></li>
<li class="chapter" data-level="24.3.2" data-path="rcpp.html"><a href="rcpp.html#strings"><i class="fa fa-check"></i><b>24.3.2</b> Strings</a></li>
<li class="chapter" data-level="24.3.3" data-path="rcpp.html"><a href="rcpp.html#boolean"><i class="fa fa-check"></i><b>24.3.3</b> Boolean</a></li>
<li class="chapter" data-level="24.3.4" data-path="rcpp.html"><a href="rcpp.html#vectors-rcpp"><i class="fa fa-check"></i><b>24.3.4</b> Vectors</a></li>
<li class="chapter" data-level="24.3.5" data-path="rcpp.html"><a href="rcpp.html#exercises-70"><i class="fa fa-check"></i><b>24.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-sugar"><i class="fa fa-check"></i><b>24.4</b> Rcpp sugar</a><ul>
<li class="chapter" data-level="24.4.1" data-path="rcpp.html"><a href="rcpp.html#arithmetic-and-logical-operators"><i class="fa fa-check"></i><b>24.4.1</b> Arithmetic and logical operators</a></li>
<li class="chapter" data-level="24.4.2" data-path="rcpp.html"><a href="rcpp.html#logical-summary-functions"><i class="fa fa-check"></i><b>24.4.2</b> Logical summary functions</a></li>
<li class="chapter" data-level="24.4.3" data-path="rcpp.html"><a href="rcpp.html#vector-views"><i class="fa fa-check"></i><b>24.4.3</b> Vector views</a></li>
<li class="chapter" data-level="24.4.4" data-path="rcpp.html"><a href="rcpp.html#other-useful-functions"><i class="fa fa-check"></i><b>24.4.4</b> Other useful functions</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="rcpp.html"><a href="rcpp.html#stl"><i class="fa fa-check"></i><b>24.5</b> The STL</a><ul>
<li class="chapter" data-level="24.5.1" data-path="rcpp.html"><a href="rcpp.html#using-iterators"><i class="fa fa-check"></i><b>24.5.1</b> Using iterators</a></li>
<li class="chapter" data-level="24.5.2" data-path="rcpp.html"><a href="rcpp.html#algorithms"><i class="fa fa-check"></i><b>24.5.2</b> Algorithms</a></li>
<li class="chapter" data-level="24.5.3" data-path="rcpp.html"><a href="rcpp.html#data-structures-rcpp"><i class="fa fa-check"></i><b>24.5.3</b> Data structures</a></li>
<li class="chapter" data-level="24.5.4" data-path="rcpp.html"><a href="rcpp.html#vectors-stl"><i class="fa fa-check"></i><b>24.5.4</b> Vectors</a></li>
<li class="chapter" data-level="24.5.5" data-path="rcpp.html"><a href="rcpp.html#sets"><i class="fa fa-check"></i><b>24.5.5</b> Sets</a></li>
<li class="chapter" data-level="24.5.6" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>24.5.6</b> Map</a></li>
<li class="chapter" data-level="24.5.7" data-path="rcpp.html"><a href="rcpp.html#exercises-71"><i class="fa fa-check"></i><b>24.5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.6" data-path="rcpp.html"><a href="rcpp.html#rcpp-case-studies"><i class="fa fa-check"></i><b>24.6</b> Case studies</a><ul>
<li class="chapter" data-level="24.6.1" data-path="rcpp.html"><a href="rcpp.html#gibbs-sampler"><i class="fa fa-check"></i><b>24.6.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="24.6.2" data-path="rcpp.html"><a href="rcpp.html#r-vectorisation-vs.c-vectorisation"><i class="fa fa-check"></i><b>24.6.2</b> R vectorisation vs. C++ vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="24.7" data-path="rcpp.html"><a href="rcpp.html#rcpp-package"><i class="fa fa-check"></i><b>24.7</b> Using Rcpp in a package</a></li>
<li class="chapter" data-level="24.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-more"><i class="fa fa-check"></i><b>24.8</b> Learning more</a></li>
<li class="chapter" data-level="24.9" data-path="rcpp.html"><a href="rcpp.html#acknowledgments"><i class="fa fa-check"></i><b>24.9</b> Acknowledgments</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="expressions" class="section level1">
<h1><span class="header-section-number">18</span> Expressions</h1>
<p>To compute on the language, we first need to understand its structure. That requires some new vocabulary, some new tools, and some new ways of thinking about R code.  The first thing you’ll need to understand is the distinction between an operation and its result. Take this code, which takes a variable <code>x</code> multiplies it by 10 and saves the result to a new variable called <code>y</code>. It doesn’t work because we haven’t defined a variable called <code>x</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span><span class="dv">10</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): Objekt &#39;x&#39; nicht gefunden</span></code></pre></div>
<p>It would be nice if we could capture the intent of the code, without executing the code. In other words, how can we separate our description of the action from performing it? One way is to use <code>rlang::expr()</code>: </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">expr</span>(y &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span><span class="dv">10</span>)
z
<span class="co">#&gt; y &lt;- x * 10</span></code></pre></div>
<p><code>expr()</code> returns a quoted <strong>expression</strong>: the R code that captures our intent.</p>
<p>In this chapter, you’ll learn about the structure of those expressions, which will also help you understand how R executes code. Later, we’ll learn about <code>eval()</code> which allows you to take such an expression and perform, or <strong>evaluate</strong>, it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">4</span>
<span class="kw">eval</span>(z)
y
<span class="co">#&gt; [1] 40</span></code></pre></div>
<div id="abstract-syntax-trees" class="section level2">
<h2><span class="header-section-number">18.1</span> Abstract syntax trees</h2>
<p>Quoted expressions are also called abstract syntax trees (AST) because the structure of code is fundamentally hierarchical and can be naturally represented as a tree. To make that more obvious we’re going to introduce some graphical conventions, illustrated with the very simple call <code>f(x, &quot;y&quot;, 1)</code>. </p>
<p><img src="diagrams/expression-simple.png" width="201" style="display: block; margin: auto;" /></p>
<ul>
<li><p>Function <strong>calls</strong> define the hierarchy of the tree. Calls are shown with an orange square. The first child (<code>f</code>) is the function that gets called. The second and subsequent children (<code>x</code>, <code>&quot;y&quot;</code>, and <code>1</code>) are the arguments.</p>
<p><strong>NB</strong>: Unlike many tree diagrams the order of the children is important: <code>f(x, 1)</code> is not the same as <code>f(1, x)</code>.</p></li>
<li><p>The leaves of the tree are either <strong>symbols</strong>, like <code>f</code> and <code>x</code>, or <strong>constants</strong> like <code>1</code> or <code>&quot;y&quot;</code>. Symbols have a purple border and rounded corners. Constants, which are atomic vectors of length one, have black borders and square corners. Strings are always surrounded in quotes to emphasise their difference to symbols — more on that later.</p></li>
</ul>
<p>Drawing these diagrams by hand takes me some time, and obviously you can’t rely on me to draw diagrams for your own code. I’ll supplement the hand-drawn trees with trees drawn by <code>lobstr::ast()</code>. <code>ast()</code> tries to make trees as similar as possible to my hand-drawn trees, while respecting the limitations of the console. Let’s use <code>ast()</code> to display the tree above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">f</span>(x, <span class="st">&quot;y&quot;</span>, <span class="dv">1</span>))
<span class="co">#&gt; █─f </span>
<span class="co">#&gt; ├─x </span>
<span class="co">#&gt; ├─&quot;y&quot; </span>
<span class="co">#&gt; └─1</span></code></pre></div>
<p>Calls get an orange square, symbols are bold and purple, and strings are surrounded by quote marks. (The formatting is not currently shown in the rendered book, but you can see it if you run the code yourself.)</p>
<p><code>ast()</code> supports “unquoting” with <code>!!</code> (pronounced bang-bang). We’ll talk about unquoting in detail in the next chapter; for now note that it’s useful if you’ve already used <code>expr()</code> to capture the expression.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">f</span>(x, <span class="st">&quot;y&quot;</span>, <span class="dv">1</span>))

<span class="co"># not useful!</span>
lobstr<span class="op">::</span><span class="kw">ast</span>(x)
<span class="co">#&gt; x</span>

<span class="co"># what we want</span>
lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x)
<span class="co">#&gt; █─f </span>
<span class="co">#&gt; ├─x </span>
<span class="co">#&gt; ├─&quot;y&quot; </span>
<span class="co">#&gt; └─1</span></code></pre></div>
<p>For more complex code, you can also use RStudio’s tree viewer to explore the AST interactively, e.g. <code>View(expr(y &lt;- x * 10))</code>.</p>
<div id="infix-vs.prefix-calls" class="section level3">
<h3><span class="header-section-number">18.1.1</span> Infix vs. prefix calls</h3>
<p>Every call in R can be written in tree form, even if it doesn’t look like it at first glance. Take <code>y &lt;- x * 10</code> again: what are the functions that are being called? It not as easy to spot as <code>f(x, 1)</code> because this expression contains two calls in <strong>infix</strong> form: <code>&lt;-</code> and <code>*</code>. Infix functions come <strong>in</strong>between their arguments (so an infix function can only have two arguments), whereas most functions in R are <strong>prefix</strong> functions where the name of the function comes first.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>In R, any infix call can be converted to a prefix call if you escape the function name with backticks. That means that these two lines of code are equivalent:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span><span class="dv">10</span>
<span class="st">`</span><span class="dt">&lt;-</span><span class="st">`</span>(y, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>(x, <span class="dv">10</span>))</code></pre></div>
<p>And they have this AST:</p>
<p><img src="diagrams/expression-prefix.png" width="216" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(y &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span><span class="dv">10</span>)
<span class="co">#&gt; █─`&lt;-` </span>
<span class="co">#&gt; ├─y </span>
<span class="co">#&gt; └─█─`*` </span>
<span class="co">#&gt;   ├─x </span>
<span class="co">#&gt;   └─10</span></code></pre></div>
<p>You might remember that code like <code>names(x) &lt;- y</code> ends up calling the <code>names&lt;-</code> function. That is not reflected in the parse tree because the translation needs to happen later, due to the complexities of nested assignments like <code>names(x)[2] &lt;- &quot;z&quot;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">names</span>(x) &lt;-<span class="st"> </span>y)
<span class="co">#&gt; █─`&lt;-` </span>
<span class="co">#&gt; ├─█─names </span>
<span class="co">#&gt; │ └─x </span>
<span class="co">#&gt; └─y</span></code></pre></div>
</div>
<div id="special-forms" class="section level3">
<h3><span class="header-section-number">18.1.2</span> Special forms</h3>
<p>R has a small number of other syntactical constructs that don’t look like either prefix or infix function calls. These are called <strong>special forms</strong> and include <code>function</code>, the control flow operators (<code>if</code>, <code>for</code>, <code>while</code>, <code>repeat</code>), and parentheses (<code>{</code>, <code>(</code>, <code>[[</code>, and <code>[</code>). These can also be written in prefix form, and hence appear in the same way in the AST:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="cf">function</span>(x, y) {
  <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span>y) {
    x
  } <span class="cf">else</span> {
    y
  }
})
<span class="co">#&gt; █─`function` </span>
<span class="co">#&gt; ├─█─x = `` </span>
<span class="co">#&gt; │ └─y = `` </span>
<span class="co">#&gt; ├─█─`{` </span>
<span class="co">#&gt; │ └─█─`if` </span>
<span class="co">#&gt; │   ├─█─`&gt;` </span>
<span class="co">#&gt; │   │ ├─x </span>
<span class="co">#&gt; │   │ └─y </span>
<span class="co">#&gt; │   ├─█─`{` </span>
<span class="co">#&gt; │   │ └─x </span>
<span class="co">#&gt; │   └─█─`{` </span>
<span class="co">#&gt; │     └─y </span>
<span class="co">#&gt; └─&lt;inline srcref&gt;</span></code></pre></div>
</div>
<div id="function-factories-1" class="section level3">
<h3><span class="header-section-number">18.1.3</span> Function factories</h3>
<p>Another small detail we need to consider are calls like <code>f()()</code>. The first component of the call is usually a symbol:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">f</span>(a, <span class="dv">1</span>))
<span class="co">#&gt; █─f </span>
<span class="co">#&gt; ├─a </span>
<span class="co">#&gt; └─1</span></code></pre></div>
<p>But if you are using a function factory, a function that returns another function, the first component might be another call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">f</span>()(a, <span class="dv">1</span>))
<span class="co">#&gt; █─█─f </span>
<span class="co">#&gt; ├─a </span>
<span class="co">#&gt; └─1</span></code></pre></div>
<p>(See <a href="expressions.html#function-factories-1">Function factories</a> for more details)</p>
<p>Of course that function might also take arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">f</span>(b, <span class="dv">2</span>)())
<span class="co">#&gt; █─█─f </span>
<span class="co">#&gt;   ├─b </span>
<span class="co">#&gt;   └─2</span></code></pre></div>
<p>These forms are relatively rare, but it’s good to be able to recognise them when they crop up.</p>
</div>
<div id="argument-names" class="section level3">
<h3><span class="header-section-number">18.1.4</span> Argument names</h3>
<p>So far the examples have only used unnamed arguments. Named arguments don’t change the parsing rules, but just add some additional metadata:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">mean</span>(<span class="dt">x =</span> mtcars<span class="op">$</span>cyl, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
<span class="co">#&gt; █─mean </span>
<span class="co">#&gt; ├─x = █─`$` </span>
<span class="co">#&gt; │     ├─mtcars </span>
<span class="co">#&gt; │     └─cyl </span>
<span class="co">#&gt; └─na.rm = TRUE</span></code></pre></div>
<p>(And note the appearance of another infix function: <code>$</code>)</p>
</div>
<div id="exercises-48" class="section level3">
<h3><span class="header-section-number">18.1.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Use <code>ast()</code> and experimentation to figure out the three arguments to an <code>if()</code> call. What would you call them? Which components are required?</p></li>
<li><p>What are the arguments to the <code>for()</code> and <code>while()</code> calls?</p></li>
<li><p>What does the call tree of an <code>if</code> statement with multiple <code>else if</code> conditions look like? Why?</p></li>
<li><p>Two arithmetic operators can be used in both prefix and infix style. What are they?</p></li>
</ol>
</div>
</div>
<div id="rs-grammar" class="section level2">
<h2><span class="header-section-number">18.2</span> R’s grammar</h2>
<p>The process by which a computer language takes a sequence of tokens (like <code>x</code>, <code>+</code>, <code>y</code>) and constructs a tree is called <strong>parsing</strong>, and it is governed by a set of rules known as a <strong>grammar</strong>. In this section, we’ll use <code>lobstr::ast()</code> to explore some of the details of R’s grammar.</p>
<p>If this is your first reading of the metaprogramming chapters, now is a good time to read the first sections of the next two chapters in order to get the big picture. Come back and learn more of the details once you’ve seen how all the big pieces fit together.</p>
<div id="operator-precedence-and-associativity" class="section level3">
<h3><span class="header-section-number">18.2.1</span> Operator precedence and associativity</h3>
<p>Infix functions introduce ambiguity in a way that prefix functions do not<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>. The parser has to resolve two sources of ambiguity when parsing infix operators. First, what does <code>1 + 2 * 3</code> yield? Do you get 9 (i.e. <code>(1 + 2) * 3</code>), or 7 (i.e. <code>1 + (2 * 3)</code>). Which of the two possible parse trees below does R use?</p>
<p><img src="diagrams/expression-ambig-order.png" width="408" style="display: block; margin: auto;" /></p>
<p>Programming langauges use conventions called <strong>operator precedence</strong> to resolve this ambiguity. We can use <code>ast()</code> to see what R does:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="dv">3</span>)
<span class="co">#&gt; █─`+` </span>
<span class="co">#&gt; ├─1 </span>
<span class="co">#&gt; └─█─`*` </span>
<span class="co">#&gt;   ├─2 </span>
<span class="co">#&gt;   └─3</span></code></pre></div>
<p>Predicting the precedence of arithmetic operations is usually easy because it’s drilled into you in school and is consistent across the vast majority of programming languages. Predicting the precedence of other operators is harder. There’s one particularly surprising finding in R: <code>!</code> has a much lower precedence (i.e. it binds less tightly) than you might expect. This allows you to write useful operations like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!</span>x <span class="op">%in%</span><span class="st"> </span>y)
<span class="co">#&gt; █─`!` </span>
<span class="co">#&gt; └─█─`%in%` </span>
<span class="co">#&gt;   ├─x </span>
<span class="co">#&gt;   └─y</span></code></pre></div>
<p>Another source of ambiguity is repeated usage of the same infix function. For example, is <code>1 + 2 + 3</code> equivalent to <code>(1 + 2) + 3</code> or to <code>1 + (2 + 3)</code>? This normally doesn’t matter because <code>x + y == y + x</code>, i.e. addition is associative. However, some S3 classes define <code>+</code> in a non-associative way. For example, ggplot2 overloads <code>+</code> to build up a complex plot from simple pieces; this usage is non-associative because earlier layers are drawn underneath later layers.</p>
<p>In R, most operators are <strong>left-associative</strong>, i.e. the operations on the left are evaluated first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span>)
<span class="co">#&gt; █─`+` </span>
<span class="co">#&gt; ├─█─`+` </span>
<span class="co">#&gt; │ ├─1 </span>
<span class="co">#&gt; │ └─2 </span>
<span class="co">#&gt; └─3</span></code></pre></div>
<p>R has over 30 infix operators divided into 18 precedence groups. While the details are descrbed in <code>?Syntax</code>, very few people have memorised the complete ordering. Indeed, if there’s any confusion, use parentheses!</p>
<p>These also appear in the AST, like all other special forms:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span>))
<span class="co">#&gt; █─`+` </span>
<span class="co">#&gt; ├─1 </span>
<span class="co">#&gt; └─█─`(` </span>
<span class="co">#&gt;   └─█─`+` </span>
<span class="co">#&gt;     ├─2 </span>
<span class="co">#&gt;     └─3</span></code></pre></div>
</div>
<div id="whitespace" class="section level3">
<h3><span class="header-section-number">18.2.2</span> Whitespace</h3>
<p>R, in general, is not sensitive to white space. Most white space is not signficiant and is not recorded in the AST. <code>x+y</code> yields exactly the same AST as <code>x +        y</code>. This means that you’re generally free to add whitespace to enhance the readability of your code. There’s one major exception:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lobstr<span class="op">::</span><span class="kw">ast</span>(y &lt;-<span class="st"> </span>x)
<span class="co">#&gt; █─`&lt;-` </span>
<span class="co">#&gt; ├─y </span>
<span class="co">#&gt; └─x</span>
lobstr<span class="op">::</span><span class="kw">ast</span>(y <span class="op">&lt;</span><span class="st"> </span><span class="op">-</span>x)
<span class="co">#&gt; █─`&lt;` </span>
<span class="co">#&gt; ├─y </span>
<span class="co">#&gt; └─█─`-` </span>
<span class="co">#&gt;   └─x</span></code></pre></div>
</div>
<div id="parsing-a-string" class="section level3">
<h3><span class="header-section-number">18.2.3</span> Parsing a string</h3>
<p>Most of the time you type code into the console, and R takes care of turning the characters you’ve typed into an AST. But occasionally you have code stored in a string, and you want to parse it yourself. You can do so using <code>rlang::parse_expr()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x1 &lt;-<span class="st"> &quot;y &lt;- x + 10&quot;</span>
lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x1)
<span class="co">#&gt; &quot;y &lt;- x + 10&quot;</span>

x2 &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">parse_expr</span>(x1)
x2
<span class="co">#&gt; y &lt;- x + 10</span>
lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x2)
<span class="co">#&gt; █─`&lt;-` </span>
<span class="co">#&gt; ├─y </span>
<span class="co">#&gt; └─█─`+` </span>
<span class="co">#&gt;   ├─x </span>
<span class="co">#&gt;   └─10</span></code></pre></div>
<p>(If you find yourself working with strings containing code very frequently, you should reconsider your work. Read the next chapter and consider if you can more safely generate expressions using quasiquotation.)</p>
<p>The base equivalent to <code>parse_expr()</code> is <code>parse()</code>. It is a little harder to use because it’s specialised for parsing R code stored in files. That means you need supply your string to the <code>text</code> argument, and you’ll get back an expression object (more on that shortly) that you’ll need to subset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parse</span>(<span class="dt">text =</span> x1)[[<span class="dv">1</span>]]
<span class="co">#&gt; y &lt;- x + 10</span></code></pre></div>
</div>
<div id="deparsing" class="section level3">
<h3><span class="header-section-number">18.2.4</span> Deparsing</h3>
<p>The opposite of parsing is <strong>deparsing</strong>: you have an AST and you want a string that would generate it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">expr</span>(y &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)
<span class="kw">expr_text</span>(z)
<span class="co">#&gt; [1] &quot;y &lt;- x + 10&quot;</span></code></pre></div>
<p>Parsing and deparsing are not perfectly symmetrical because parsing throws away all information not directly related to the AST. This includes backticks around ordinary names, comments, and whitespace:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="kw">expr_text</span>(<span class="kw">expr</span>({
  <span class="co"># This is a comment</span>
  x &lt;-<span class="st">             `</span><span class="dt">x</span><span class="st">`</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
})))
<span class="co">#&gt; {</span>
<span class="co">#&gt;     x &lt;- x + 1</span>
<span class="co">#&gt; }</span></code></pre></div>
<p>Deparsing is often used to provide default names for data structures (like data frames), and default labels for messages or other output. rlang provides two helpers for those situations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">f</span>(x, y, z))

<span class="kw">expr_name</span>(z)
<span class="co">#&gt; [1] &quot;f(x, y, z)&quot;</span>
<span class="kw">expr_label</span>(z)
<span class="co">#&gt; [1] &quot;`f(x, y, z)`&quot;</span></code></pre></div>
<p>Be careful when using the base R equivalent, <code>deparse()</code>: it returns a character vector, and with one element for each line. Whenever you use it, remember that the length of the output might be greater than one, and plan accordingly.</p>
</div>
<div id="exercises-49" class="section level3">
<h3><span class="header-section-number">18.2.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>R uses parentheses in two slightly different ways as illustrated by this simple call: <code>f((1))</code>. Compare and contrast the two uses.</p></li>
<li><p><code>=</code> can also be used in two ways. Construct a simple example that shows both uses.</p></li>
<li><p>What does <code>!1 + !1</code> return? Why?</p></li>
<li><p>Which arithmetic operation is right associative?</p></li>
<li><p>Why does <code>x1 &lt;- x2 &lt;- x3 &lt;- 0</code> work? There are two reasons.</p></li>
<li><p>Compare <code>x + y %+% z</code> to <code>x ^ y %+% z</code>. What does that tell you about the precedence of custom infix functions?</p></li>
<li><p><code>deparse()</code> produces vectors when the input is long. For example, the following call produces a vector of length two:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">expr &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">g</span>(a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c <span class="op">+</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span>e <span class="op">+</span><span class="st"> </span>f <span class="op">+</span><span class="st"> </span>g <span class="op">+</span><span class="st"> </span>h <span class="op">+</span><span class="st"> </span>i <span class="op">+</span><span class="st"> </span>j <span class="op">+</span><span class="st"> </span>k <span class="op">+</span><span class="st"> </span>l <span class="op">+</span><span class="st"> </span>m <span class="op">+</span>
<span class="st">  </span>n <span class="op">+</span><span class="st"> </span>o <span class="op">+</span><span class="st"> </span>p <span class="op">+</span><span class="st"> </span>q <span class="op">+</span><span class="st"> </span>r <span class="op">+</span><span class="st"> </span>s <span class="op">+</span><span class="st"> </span>t <span class="op">+</span><span class="st"> </span>u <span class="op">+</span><span class="st"> </span>v <span class="op">+</span><span class="st"> </span>w <span class="op">+</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span>z))

<span class="kw">deparse</span>(expr)</code></pre></div>
<p>What do <code>expr_text()</code>, <code>expr_name()</code>, and <code>expr_label()</code> do?</p></li>
</ol>
</div>
</div>
<div id="data-structures" class="section level2">
<h2><span class="header-section-number">18.3</span> Data structures</h2>
<p>Now that you have a good feel for ASTs and how R’s grammar helps to define them, it’s time to look into more detail about the underlying implementation. In this section you’ll learn about the data structures that R uses to implement the AST:</p>
<ul>
<li>Constants and symbols, the leaves of the tree.</li>
<li>Calls, the branches of the tree.</li>
<li>Pairlists, a historical data structure now only used for function arguments.</li>
</ul>
<p>Before we continue, a word of caution about the naming conventions used in this book. Unfortunately, base R does not have a consistent set of conventions, so we’ve had to make our own. We use them consistently in the book and in rlang, but you’ll need to remember some translations when reading base R documentation.</p>
<p>We use expression to refer collectively to the data structures that can appear in an AST (constant, symbol, call, pairlist). In base R, “expression” is a special type that is basically equivalent to a list of what we call expressions. To avoid confusion (as much as possible) we’ll call these <strong>expression objects</strong>, and we’ll discuss in <a href="expressions.html#expression-objects">expression objects</a>.</p>
<p>Base R does not have an equivalent term for our “expression”. The closest is “language object”, which includes symbols and calls, but not constants or pairlists. But note that <code>typeof()</code> and <code>str()</code> use “language” to mean call. Base R uses symbol and name interchangeably; we prefer symbol because “name” has other common meanings (e.g. the name of a variable).</p>
<div id="constants-and-symbols" class="section level3">
<h3><span class="header-section-number">18.3.1</span> Constants and symbols</h3>
<p>Constants and symbols are the leaves of the AST. Symbols represent variable names, and constants represent literal values.</p>
<p>Constants are “self-quoting” in the sense that the expression used to represent a constant is the constant itself:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(<span class="kw">expr</span>(<span class="st">&quot;x&quot;</span>), <span class="st">&quot;x&quot;</span>)
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">identical</span>(<span class="kw">expr</span>(<span class="ot">TRUE</span>), <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">identical</span>(<span class="kw">expr</span>(<span class="dv">1</span>), <span class="dv">1</span>)
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">identical</span>(<span class="kw">expr</span>(<span class="dv">2</span>), <span class="dv">2</span>)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Symbols are used to represent variables. You can convert back and forth between symbols and the strings that represent them with <code>sym()</code> and <code>as_string()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">&quot;x&quot;</span>
<span class="co">#&gt; [1] &quot;x&quot;</span>
<span class="kw">sym</span>(<span class="st">&quot;x&quot;</span>)
<span class="co">#&gt; x</span>
<span class="kw">as_string</span>(<span class="kw">sym</span>(<span class="st">&quot;x&quot;</span>))
<span class="co">#&gt; [1] &quot;x&quot;</span></code></pre></div>
<div id="the-missing-symbol" class="section level4">
<h4><span class="header-section-number">18.3.1.1</span> The missing symbol</h4>
<p>There’s one special symbol that needs a little extra discussion: the empty symbol which is used to represent missing arguments. You can make it with <code>missing_arg()</code> (or <code>expr()</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">missing_arg</span>()</code></pre></div>
<p>The missing argument throws an error if the symbol it is bound to is accessed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m1 &lt;-<span class="st"> </span><span class="kw">missing_arg</span>()
m1
<span class="co">#&gt; Error in eval(expr, envir, enclos): Argument &quot;m1&quot; fehlt (ohne Standardwert)</span></code></pre></div>
<p>This gives it rather peculaiar behaviour since you can still access it in if it’s stored in another data structure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">missing_arg</span>())
m2[[<span class="dv">1</span>]]</code></pre></div>
<p>If you do need to work with a missing argument stored in a variable, you can wrap up any accesses with <code>maybe_missing()</code> :</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">maybe_missing</span>(m1)</code></pre></div>
<p>That prevents the error from occurring and instead returns another empty symbol.</p>
<p>You can see if it’s misisng by using <code>is_missing()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is_missing</span>(m1)
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">is_missing</span>(m2[[<span class="dv">1</span>]])
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>You only need to know about the missing symbol if you’re programmatically creating functions with missing arguments; we’ll come back to that in the next chapter. </p>
</div>
</div>
<div id="calls" class="section level3">
<h3><span class="header-section-number">18.3.2</span> Calls</h3>
<p>Calls define the tree in AST. A call behaves similarly to a list. It has a <code>length()</code>; you can extract elements with <code>[[</code>, <code>[</code>, and <code>$</code>; and calls can contain other calls. The main difference is that the first element of a call is special: it’s the function that will get called.  Let’s explore these ideas with a simple example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">read.table</span>(<span class="st">&quot;important.csv&quot;</span>, <span class="dt">row =</span> <span class="ot">FALSE</span>))
lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x)
<span class="co">#&gt; █─read.table </span>
<span class="co">#&gt; ├─&quot;important.csv&quot; </span>
<span class="co">#&gt; └─row = FALSE</span></code></pre></div>
<p>The length of a call minus one gives the number of arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(x) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
<span class="co">#&gt; [1] 2</span></code></pre></div>
<p>The names of a call are empty, except for named arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(x)
<span class="co">#&gt; [1] &quot;&quot;    &quot;&quot;    &quot;row&quot;</span></code></pre></div>
<p>You can extract the leaves of the call by position and by name using <code>[[</code> and <code>$</code> in the usual way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x[[<span class="dv">1</span>]]
<span class="co">#&gt; read.table</span>
x[[<span class="dv">2</span>]]
<span class="co">#&gt; [1] &quot;important.csv&quot;</span>

x<span class="op">$</span>row
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>Extracting specific arguments from calls is challenging because of R’s flexible rules for argument matching: it could potentially be in any location, with the full name, with an abreviated name, or with no name. To work around this problem, you can use <code>rlang::lang_standardise()</code> which standardises all arguments to use the full name: </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rlang<span class="op">::</span><span class="kw">lang_standardise</span>(x)
<span class="co">#&gt; read.table(file = &quot;important.csv&quot;, row.names = FALSE)</span></code></pre></div>
<p>(Note that if the function uses <code>...</code> it’s not possible to standardise all arguments.)</p>
<p>You can use <code>[</code> to extract multiple components, but if you drop the the first element, you’re usually going to end up with a weird call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]
<span class="co">#&gt; &quot;important.csv&quot;(row = FALSE)</span></code></pre></div>
<p>If you do want to extract multiple elements in this way, it’s good practice to coerce the results to a list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.list</span>(x[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] &quot;important.csv&quot;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $row</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>Calls can be modified in the same way as lists:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x<span class="op">$</span>header &lt;-<span class="st"> </span><span class="ot">TRUE</span>
x
<span class="co">#&gt; read.table(&quot;important.csv&quot;, row = FALSE, header = TRUE)</span></code></pre></div>
<p>You can also construct a call from scratch using <code>rlang::lang()</code>. The first argument should be the function to be called (supplied either as a string or a symbol), and the subsequent arguments are the call to that function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lang</span>(<span class="st">&quot;mean&quot;</span>, <span class="dt">x =</span> <span class="kw">expr</span>(x), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; mean(x = x, na.rm = TRUE)</span></code></pre></div>
</div>
<div id="pairlists" class="section level3">
<h3><span class="header-section-number">18.3.3</span> Pairlists</h3>
<p>There is one data structure we need to discuss for completeness: the pairlist.  Pairlists are a remnant of R’s past and have been replaced by lists almost everywhere. The only place you are likely to see pairlists in R is when working with function arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="dv">10</span>) x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
<span class="kw">typeof</span>(<span class="kw">formals</span>(f))
<span class="co">#&gt; [1] &quot;pairlist&quot;</span></code></pre></div>
<p>(If you’re working in C, you’ll encounter pairlists more often. For example, calls are also implemented using pairlists)</p>
<p>Fortunately, whenever you encounter a pairlist, you can treat it just like a regular list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pl &lt;-<span class="st"> </span><span class="kw">pairlist</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">2</span>)
<span class="kw">length</span>(pl)
<span class="co">#&gt; [1] 2</span>
pl<span class="op">$</span>x
<span class="co">#&gt; [1] 1</span></code></pre></div>
<p>However, behind the scenes pairlists are implemented using a different data structure, a linked list instead of a vector. That means that subsetting is slower with pairlists, and gets slower the further along the pairlist you index:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l1 &lt;-<span class="st"> </span><span class="kw">as.list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>)
l2 &lt;-<span class="st"> </span><span class="kw">as.pairlist</span>(l1)

microbenchmark<span class="op">::</span><span class="kw">microbenchmark</span>(
  l1[[<span class="dv">1</span>]],
  l1[[<span class="dv">10</span>]],
  l2[[<span class="dv">1</span>]],
  l2[[<span class="dv">10</span>]]
)
<span class="co">#&gt; Unit: nanoseconds</span>
<span class="co">#&gt;      expr min  lq mean median  uq  max neval cld</span>
<span class="co">#&gt;   l1[[1]] 186 198  268    210 234 4797   100  a </span>
<span class="co">#&gt;  l1[[10]] 188 202  228    219 246  532   100  a </span>
<span class="co">#&gt;   l2[[1]] 551 576  610    595 622  977   100   b</span>
<span class="co">#&gt;  l2[[10]] 554 586  656    604 632 4781   100   b</span></code></pre></div>
</div>
<div id="expression-objects" class="section level3">
<h3><span class="header-section-number">18.3.4</span> Expression objects</h3>
<p>Finally, we need to discuss the expression object briefly.  Expression objects are produced by only two base functions: <code>expression()</code> and <code>parse()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp1 &lt;-<span class="st"> </span><span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">c</span>(<span class="st">&quot;</span>
<span class="st">x &lt;- 4</span>
<span class="st">x</span>
<span class="st">&quot;</span>))
exp2 &lt;-<span class="st"> </span><span class="kw">expression</span>(x &lt;-<span class="st"> </span><span class="dv">4</span>, x)

<span class="kw">typeof</span>(exp1)
<span class="co">#&gt; [1] &quot;expression&quot;</span>
<span class="kw">typeof</span>(exp2)
<span class="co">#&gt; [1] &quot;expression&quot;</span>

exp1
<span class="co">#&gt; expression(x &lt;- 4, x)</span>
exp2
<span class="co">#&gt; expression(x &lt;- 4, x)</span></code></pre></div>
<p> </p>
<p>Like calls and pairlists, expression objects behave like a list:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(exp1)
<span class="co">#&gt; [1] 2</span>
exp1[[<span class="dv">1</span>]]
<span class="co">#&gt; x &lt;- 4</span></code></pre></div>
<p>Conceptually an expression object is just a list of expressions. The only difference is that calling <code>eval()</code> on an expression evaluates each individual expression. We don’t believe this advantage merits introducing a new data structure, so instead of expression objects we always use regular lists of expressions.</p>
<p>Because there might be many top-level calls in a file, <code>parse()</code> doesn’t return just a single expression. Instead, it returns an expression object, which is essentially a list of expressions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(exp)
<span class="co">#&gt; [1] 1</span>
<span class="kw">typeof</span>(exp)
<span class="co">#&gt; [1] &quot;builtin&quot;</span></code></pre></div>
</div>
<div id="exercises-50" class="section level3">
<h3><span class="header-section-number">18.3.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Which two of the six types of atomic vector can’t appear in an expression? Why? Why can’t you create an expression that contains an atomic vector of length greater than one?</p></li>
<li><p><code>standardise_call()</code> doesn’t work so well for the following calls. Why?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lang_standardise</span>(<span class="kw">quote</span>(<span class="kw">mean</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))
<span class="co">#&gt; mean(x = 1:10, na.rm = TRUE)</span>
<span class="kw">lang_standardise</span>(<span class="kw">quote</span>(<span class="kw">mean</span>(<span class="dt">n =</span> T, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))
<span class="co">#&gt; mean(x = 1:10, n = T)</span>
<span class="kw">lang_standardise</span>(<span class="kw">quote</span>(<span class="kw">mean</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, , <span class="ot">TRUE</span>)))
<span class="co">#&gt; mean(x = 1:10, , TRUE)</span></code></pre></div></li>
<li><p>Why does this code not make sense?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">foo</span>(<span class="dt">x =</span> <span class="dv">1</span>))
<span class="kw">names</span>(x) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;&quot;</span>)</code></pre></div></li>
<li><p><code>base::alist()</code> is useful for creating pairlists to be used for function arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">foo &lt;-<span class="st"> </span><span class="cf">function</span>() {}
<span class="kw">formals</span>(foo) &lt;-<span class="st"> </span><span class="kw">alist</span>(<span class="dt">x =</span> , <span class="dt">y =</span> <span class="dv">1</span>)
foo
<span class="co">#&gt; function (x, y = 1) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt; }</span></code></pre></div>
<p>What makes <code>alist()</code> special compared to <code>list()</code>?</p></li>
<li><p>Concatenating a call and an expression with <code>c()</code> creates a list. Implement <code>concat()</code> so that the following code works to combine a call and an additional argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="kw">quote</span>(<span class="kw">f</span>()), <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="kw">quote</span>(<span class="kw">mean</span>(a)))
<span class="kw">concat</span>(<span class="kw">quote</span>(f), <span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="kw">quote</span>(<span class="kw">mean</span>(a)))
<span class="co">#&gt; f(a = 1, b = mean(a))</span></code></pre></div></li>
</ol>
</div>
</div>
<div id="case-study-anaphoric-functions" class="section level2">
<h2><span class="header-section-number">18.4</span> Case study: anaphoric functions</h2>
<p>One useful application of <code>make_function()</code> is in functions like <code>curve()</code>. <code>curve()</code> allows you to plot a mathematical function without creating an explicit R function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">curve</span>(<span class="kw">sin</span>(<span class="kw">exp</span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>x)), <span class="dt">n =</span> <span class="dv">1000</span>)</code></pre></div>
<p><img src="Expressions_files/figure-html/curve-demo-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Here <code>x</code> is a pronoun. <code>x</code> doesn’t represent a single concrete value, but is instead a placeholder that varies over the range of the plot. One way to implement <code>curve()</code> would be with <code>make_function()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">curve4 &lt;-<span class="st"> </span><span class="cf">function</span>(expr, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">n =</span> <span class="dv">100</span>) {
  expr &lt;-<span class="st"> </span><span class="kw">enquo</span>(expr)
  f &lt;-<span class="st"> </span><span class="kw">new_function</span>(<span class="kw">alist</span>(<span class="dt">x =</span> ), <span class="kw">get_expr</span>(expr), <span class="kw">get_env</span>(env))

  x &lt;-<span class="st"> </span><span class="kw">seq</span>(xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], <span class="dt">length =</span> n)
  y &lt;-<span class="st"> </span><span class="kw">f</span>(x)

  <span class="kw">plot</span>(x, y, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(expr)))
}
<span class="kw">curve4</span>(<span class="kw">sin</span>(<span class="kw">exp</span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>x)), <span class="dt">n =</span> <span class="dv">1000</span>)


curve3 &lt;-<span class="st"> </span><span class="cf">function</span>(expr, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">n =</span> <span class="dv">100</span>) {
  expr &lt;-<span class="st"> </span><span class="kw">enquo</span>(expr)
  e &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">expr</span>({
    <span class="cf">function</span>(x) <span class="op">!!</span><span class="kw">get_expr</span>(expr)
  })
  f &lt;-<span class="st"> </span><span class="kw">eval_tidy</span>(e, <span class="dt">env =</span> <span class="kw">get_env</span>(expr))

  x &lt;-<span class="st"> </span><span class="kw">seq</span>(xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], <span class="dt">length =</span> n)
  y &lt;-<span class="st"> </span><span class="kw">f</span>(x)

  <span class="kw">plot</span>(x, y, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(expr)))
}

<span class="kw">curve3</span>(<span class="kw">sin</span>(<span class="kw">exp</span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>x)), <span class="dt">n =</span> <span class="dv">1000</span>)</code></pre></div>
<p><img src="Expressions_files/figure-html/curve2-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Functions that use a pronoun are called <a href="http://en.wikipedia.org/wiki/Anaphora_(linguistics)">anaphoric</a> functions. They are used in <a href="http://www.arcfn.com/doc/anaphoric.html">Arc</a> (a lisp like language), <a href="http://www.perlmonks.org/index.pl?node_id=666047">Perl</a>, and <a href="http://amalloy.hubpages.com/hub/Unhygenic-anaphoric-Clojure-macros-for-fun-and-profit">Clojure</a>.  </p>
<div id="exercises-51" class="section level3">
<h3><span class="header-section-number">18.4.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>How are <code>alist(a)</code> and <code>alist(a = )</code> different? Think about both the input and the output.</p></li>
<li><p>Read the documentation and source code for <code>pryr::partial()</code>. What does it do? How does it work? Read the documentation and source code for <code>pryr::unenclose()</code>. What does it do and how does it work?</p></li>
<li><p>The actual implementation of <code>curve()</code> looks more like</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">curve3 &lt;-<span class="st"> </span><span class="cf">function</span>(expr, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">n =</span> <span class="dv">100</span>,
                   <span class="dt">env =</span> <span class="kw">parent.frame</span>()) {
  env2 &lt;-<span class="st"> </span><span class="kw">new.env</span>(<span class="dt">parent =</span> env)
  env2<span class="op">$</span>x &lt;-<span class="st"> </span><span class="kw">seq</span>(xlim[<span class="dv">1</span>], xlim[<span class="dv">2</span>], <span class="dt">length =</span> n)

  y &lt;-<span class="st"> </span><span class="kw">eval</span>(<span class="kw">substitute</span>(expr), env2)
  <span class="kw">plot</span>(env2<span class="op">$</span>x, y, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, 
    <span class="dt">ylab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(expr)))
}</code></pre></div>
<p>How does this approach differ from <code>curve2()</code> defined above?</p></li>
</ol>
</div>
</div>
<div id="ast-funs" class="section level2">
<h2><span class="header-section-number">18.5</span> Case study: Walking the AST with recursive functions</h2>
<p>To conclude the chapter we’re going to pull together everything that you’ve learned about ASTs to write solve more complicated tasks. Some inspiration comes from the base codetools package, which provides two interesting functions: </p>
<ul>
<li><p><code>findGlobals()</code> locates all global variables used by a function. This can be useful if you want to check that your function doesn’t inadvertently rely on variables defined in their parent environment.</p></li>
<li><p><code>checkUsage()</code> checks for a range of common problems including unused local variables, unused parameters, and the use of partial argument matching.</p></li>
</ul>
<p>Getting all of the details of this functions correct is fiddly and complex, so we’re not going to explore the full expression. Instead we’ll focus on the big ideas needed to implement functions that work like them, namely recursion. Recursive functions are a natural fit to tree-like data structures because a recursive function is made up of two parts:</p>
<ul>
<li><p>The <strong>recursive case</strong> handles the nodes in the tree. Typically, you’ll do something to each child of node, usually calling the recursive function again, and then combine the results back together again. For expressions, you’ll need to handle calls and pairlists in the recursive case.</p></li>
<li><p>The <strong>base case</strong> handles the leaves of the tree. The base cases ensure that the function eventually terminates, by solving the simplest cases directly. For expressions, you need to base symbol and names in the base case.</p></li>
</ul>
<p>To make this pattern easier to see, we’ll use two helper functions. First we define <code>expr_type()</code> which will return “constant” for constant, “symbol” for symbols, “call”, for calls, “pairlist” for pairlists, and the “type” of anything else:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">expr_type &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">if</span> (rlang<span class="op">::</span><span class="kw">is_syntactic_literal</span>(x)) {
    <span class="st">&quot;constant&quot;</span>
  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.symbol</span>(x)) {
    <span class="st">&quot;symbol&quot;</span>
  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.call</span>(x)) {
    <span class="st">&quot;call&quot;</span>
  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.pairlist</span>(x)) {
    <span class="st">&quot;pairlist&quot;</span>
  } <span class="cf">else</span> {
    <span class="kw">typeof</span>(x)
  }
}

<span class="kw">expr_type</span>(<span class="kw">expr</span>(<span class="st">&quot;a&quot;</span>))
<span class="co">#&gt; [1] &quot;constant&quot;</span>
<span class="kw">expr_type</span>(<span class="kw">expr</span>(<span class="kw">f</span>(<span class="dv">1</span>, <span class="dv">2</span>)))
<span class="co">#&gt; [1] &quot;call&quot;</span></code></pre></div>
<p>We’ll couple this with a wrapper around the switch function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">switch_expr &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {
  <span class="cf">switch</span>(<span class="kw">expr_type</span>(x), 
    ..., 
    <span class="kw">stop</span>(<span class="st">&quot;Don&#39;t know how to handle type &quot;</span>, <span class="kw">typeof</span>(x), <span class="dt">call. =</span> <span class="ot">FALSE</span>)  
  )
}</code></pre></div>
<p>With these two functions in hand, the basic template for any function that walks the AST is as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">recurse_call &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">switch_expr</span>(x, 
    <span class="co"># Base cases</span>
    <span class="dt">symbol =</span> ,
    <span class="dt">constant =</span> ,
    
    <span class="co"># Recursive cases</span>
    <span class="dt">call =</span> ,
    <span class="dt">pairlist =</span> 
  )
}</code></pre></div>
<p>Typically, solving the base case will easy so we’ll do that first, and check the results. The recursive cases are a little more tricky, but typically you just need to think about the data structure you want in the output and then find the correct purrr function. To that end, make sure you’re familiar with <a href="functionals.html#functionals">Functionals</a> before continuing.</p>
<div id="finding-f-and-t" class="section level3">
<h3><span class="header-section-number">18.5.1</span> Finding F and T</h3>
<p>We’ll start simple with a function that determines whether a function uses the logical abbreviations <code>T</code> and <code>F</code>: it will return <code>TRUE</code> if it finds a logical abbreviation, and <code>FALSE</code> otherwise. Using <code>T</code> and <code>F</code> is generally considered to be poor coding practice, and is something that <code>R CMD check</code> will warn about.</p>
<p>Let’s first compare the AST for <code>T</code> vs. <code>TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ast</span>(<span class="ot">TRUE</span>)
<span class="co">#&gt; TRUE</span>
<span class="kw">ast</span>(T)
<span class="co">#&gt; T</span></code></pre></div>
<p><code>TRUE</code> is parsed as a logical vector of length one, while <code>T</code> is parsed as a name. This tells us how to write our base cases for the recursive function: a constant is never a logical abbreviation, and a symbol is an abbreviation if it’s “F” or “T”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logical_abbr_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">switch_expr</span>(x, 
    <span class="dt">constant =</span> <span class="ot">FALSE</span>,
    <span class="dt">symbol =</span> <span class="kw">as_string</span>(x) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;T&quot;</span>)
  )
}

<span class="kw">logical_abbr_rec</span>(<span class="kw">expr</span>(<span class="ot">TRUE</span>))
<span class="co">#&gt; [1] FALSE</span>
<span class="kw">logical_abbr_rec</span>(<span class="kw">expr</span>(T))
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Our recursive function works with expressions which means we always need to use it with <code>expr()</code>. When writing a recursive function it’s common to write a wrapper that provides defaults or makes the function a little easier to use. Here we’ll typically make a wrapper that quotes its input (we’ll learn more about that in the next chapter), so we don’t need to use <code>expr()</code> every time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logical_abbr &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">logical_abbr_rec</span>(<span class="kw">enexpr</span>(x))
}

<span class="kw">logical_abbr</span>(T)
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">logical_abbr</span>(<span class="ot">FALSE</span>)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>Next we need to implement the recursive cases. Here it’s simple because we want to do the same thing for calls and for pairlists: recursively apply the function to each subcomponent, and return <code>TRUE</code> if any subcomponent contains a logical abbreviation. This is made easy by <code>purrr::some()</code>, which iterates over a list and returns <code>TRUE</code> if the predicate function is true for any element.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logical_abbr_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">switch_expr</span>(x,
    <span class="co"># Base cases</span>
    <span class="dt">constant =</span> <span class="ot">FALSE</span>,
    <span class="dt">symbol =</span> <span class="kw">as_string</span>(x) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;T&quot;</span>),
    
    <span class="co"># Recursive cases</span>
    <span class="dt">call =</span> ,
    <span class="dt">pairlist =</span> purrr<span class="op">::</span><span class="kw">some</span>(x, logical_abbr_rec)
  )
}

<span class="kw">logical_abbr</span>(<span class="kw">mean</span>(x, <span class="dt">na.rm =</span> T))
<span class="co">#&gt; [1] TRUE</span>
<span class="kw">logical_abbr</span>(<span class="cf">function</span>(x, <span class="dt">na.rm =</span> T) <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div id="finding-all-variables-created-by-assignment" class="section level3">
<h3><span class="header-section-number">18.5.2</span> Finding all variables created by assignment</h3>
<p><code>logical_abbr()</code> is very simple: it only returns a single <code>TRUE</code> or <code>FALSE</code>. The next task, listing all variables created by assignment, is a little more complicated. We’ll start simply, and then make the function progressively more rigorous. </p>
<p>We start by looking at the AST for assignment:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ast</span>(x &lt;-<span class="st"> </span><span class="dv">10</span>)
<span class="co">#&gt; █─`&lt;-` </span>
<span class="co">#&gt; ├─x </span>
<span class="co">#&gt; └─10</span></code></pre></div>
<p>Assignment is a call where the first element is the symbol <code>&lt;-</code>, the second is name of variable, and the third is the value to be assigned.</p>
<p>Next, we need to decide what data structure we’re going to use for the results. Here I think it will be easiest it we return a character vector. If we return symbols, we’ll need to use a <code>list()</code> and that makes things a little more complicated.</p>
<p>With that in hand we can start by implementing the base cases and providing a helpful wrapper around the recursive function. The base cases here are really simple!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">find_assign_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">switch_expr</span>(x, 
    <span class="dt">constant =</span> ,
    <span class="dt">symbol =</span> <span class="kw">character</span>()
  )  
}
find_assign &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">find_assign_rec</span>(<span class="kw">enexpr</span>(x))

<span class="kw">find_assign</span>(<span class="st">&quot;x&quot;</span>)
<span class="co">#&gt; character(0)</span>
<span class="kw">find_assign</span>(x)
<span class="co">#&gt; character(0)</span></code></pre></div>
<p>Next we implement the recursive cases. This is made easier by a function that should exist in purrrr, but currently doesn’t:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flat_map_chr &lt;-<span class="st"> </span><span class="cf">function</span>(.x, .f, ...) {
  purrr<span class="op">::</span><span class="kw">flatten_chr</span>(purrr<span class="op">::</span><span class="kw">map</span>(.x, .f, ...))
}</code></pre></div>
<p>The recursive case for pairlists is simple: we iterate of every element of the pairlist (i.e. each function argument) and combine the results. The case for calls is a little bit more complex - if this is a call to <code>&lt;-</code> then we should return the second element of the call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">find_assign_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">switch_expr</span>(x,
    <span class="co"># Base cases</span>
    <span class="dt">constant =</span> ,
    <span class="dt">symbol =</span> <span class="kw">character</span>(),
    
    <span class="co"># Recursive cases</span>
    <span class="dt">pairlist =</span> <span class="kw">flat_map_chr</span>(<span class="kw">as.list</span>(x), find_assign_rec),
    <span class="dt">call =</span> {
      <span class="cf">if</span> (<span class="kw">is_call</span>(x, <span class="st">&quot;&lt;-&quot;</span>)) {
        <span class="kw">as_string</span>(x[[<span class="dv">2</span>]])
      } <span class="cf">else</span> {
        <span class="kw">flat_map_chr</span>(<span class="kw">as.list</span>(x), find_assign_rec)
      }
    }
  )
}

<span class="co"># find_assign(function(x = 1) {})</span>
<span class="co"># Need to handle srcrefs</span>
<span class="co"># Maybe move to new section specifically about functions?</span>

<span class="kw">find_assign</span>(a &lt;-<span class="st"> </span><span class="dv">1</span>)
<span class="co">#&gt; [1] &quot;a&quot;</span>
<span class="kw">find_assign</span>({
  a &lt;-<span class="st"> </span><span class="dv">1</span>
  {
    b &lt;-<span class="st"> </span><span class="dv">2</span>
  }
})
<span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot;</span></code></pre></div>
<p>Now we need to make our function more robust but coming up with examples intended to break it. What happens we assign to the same variable multiple times?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">find_assign</span>({
  a &lt;-<span class="st"> </span><span class="dv">1</span>
  a &lt;-<span class="st"> </span><span class="dv">2</span>
})
<span class="co">#&gt; [1] &quot;a&quot; &quot;a&quot;</span></code></pre></div>
<p>It’s easiest to fix this at the level of the wrapper function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">find_assign &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">unique</span>(<span class="kw">find_assign_rec</span>(<span class="kw">enexpr</span>(x)))

<span class="kw">find_assign</span>({
  a &lt;-<span class="st"> </span><span class="dv">1</span>
  a &lt;-<span class="st"> </span><span class="dv">2</span>
})
<span class="co">#&gt; [1] &quot;a&quot;</span></code></pre></div>
<p>What happens if we have multiple calls to assign? Currently we only return the first. That’s because when <code>&lt;-</code> occurs we immediately terminate recursion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">find_assign</span>({
  a &lt;-<span class="st"> </span>b &lt;-<span class="st"> </span>c &lt;-<span class="st"> </span><span class="dv">1</span>
})
<span class="co">#&gt; [1] &quot;a&quot;</span></code></pre></div>
<p>Instead we need to take a more rigorous approach. I think it’s best to keep the recursive function focused on the tree structure, so I’m going to extract out <code>find_assign_call()</code> into a separate function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">find_assign_call &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">if</span> (<span class="kw">is_call</span>(x, <span class="st">&quot;&lt;-&quot;</span>) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">is.symbol</span>(x[[<span class="dv">2</span>]])) {
    lhs &lt;-<span class="st"> </span><span class="kw">as_string</span>(x[[<span class="dv">2</span>]])
    children &lt;-<span class="st"> </span><span class="kw">as.list</span>(x)[<span class="op">-</span><span class="dv">1</span>]
  } <span class="cf">else</span> {
    lhs &lt;-<span class="st"> </span><span class="kw">character</span>()
    children &lt;-<span class="st"> </span><span class="kw">as.list</span>(x)
  }
  
  <span class="kw">c</span>(lhs, <span class="kw">flat_map_chr</span>(children, find_assign_rec))
}

find_assign_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="kw">switch_expr</span>(x,
    <span class="co"># Base cases</span>
    <span class="dt">constant =</span> ,
    <span class="dt">symbol =</span> <span class="kw">character</span>(),
    
    <span class="co"># Recursive cases</span>
    <span class="dt">pairlist =</span> <span class="kw">flat_map_chr</span>(x, find_assign_rec),
    <span class="dt">call =</span> <span class="kw">find_assign_call</span>(x)
  )
}

<span class="kw">find_assign</span>(a &lt;-<span class="st"> </span>b &lt;-<span class="st"> </span>c &lt;-<span class="st"> </span><span class="dv">1</span>)
<span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span>
<span class="kw">find_assign</span>(<span class="kw">system.time</span>(x &lt;-<span class="st"> </span><span class="kw">print</span>(y &lt;-<span class="st"> </span><span class="dv">5</span>)))
<span class="co">#&gt; [1] &quot;x&quot; &quot;y&quot;</span>
<span class="kw">find_assign</span>(<span class="kw">names</span>(l) &lt;-<span class="st"> &quot;b&quot;</span>)
<span class="co">#&gt; character(0)</span></code></pre></div>
<p>While the complete version of this function is quite complicated, it’s important to remember we wrote it by working our way up by writing simple component parts.</p>
</div>
<div id="exercises-52" class="section level3">
<h3><span class="header-section-number">18.5.3</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p><code>logical_abbr()</code> works with expressions. It currently fails when you give it a function. Why not? How could you modify <code>logical_abbr()</code> to make it work? What components will you need to recurse over?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="ot">TRUE</span>) {
  <span class="kw">g</span>(x <span class="op">+</span><span class="st"> </span>T)
}
<span class="kw">logical_abbr</span>(<span class="op">!!</span>f)</code></pre></div></li>
<li><p>Write a function that extracts all calls to a function.</p></li>
<li><p>Instead of writing a wrapper that quotes its input, we could have made the recursive function itself a quoting function. Why is this suboptimal?</p></li>
</ol>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>You might be familiar with the name Quine from “quines”, computer programs that when run return a copy of their own source code.<a href="expressions.html#fnref1">↩</a></p></li>
<li id="fn2"><p>These two sources of ambiguity do not exist without infix operators, which can be considered an advantage of purely prefix and postfix languages. It’s interesting to compare a simple arithmetic operation in Lisp (prefix) and Forth (postfix). In Lisp you’d write <code>(+ (+ 1 2) 3))</code>; this avoids ambiguity by requiring parentheses everywhere. In Forth, you’d write <code>1 2 + 3 +</code>; this doesn’t require any parentheses, at the cost of requiring more thought when reading.<a href="expressions.html#fnref2">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="meta.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="quasiquotation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/adv-r/edit/master/Expressions.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
